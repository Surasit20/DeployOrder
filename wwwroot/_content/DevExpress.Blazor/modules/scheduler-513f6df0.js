import{d as t}from"./dom-f93f7533.js";import{D as e}from"./dx-html-element-base-3906936e.js";import{DxUIHandlersBridgeTagName as i}from"./dx-ui-handlers-bridge-4076ae57.js";import{d as n,F as s,f as o,u as r}from"./dom-utils-04e3c6d2.js";import{H as l,c as a,d as p,P as c,a as u}from"./dx-html-element-pointer-events-helper-4b46ddbf.js";import{S as d}from"./dx-scroll-viewer-11139ffa.js";import{S as h}from"./scroll-viewer-css-classes-af8d2aac.js";import{t as m}from"./touch-b17c92da.js";import{q as f}from"./popup-3304c929.js";import"./_tslib-6e8ca86b.js";import"./data-qa-utils-8be7c726.js";import"./css-classes-f3f8ed66.js";import"./eventhelper-8570b930.js";import"./pointer-event-helper-ba4ce1e1.js";import"./constants-58283e53.js";import"./rect-00eb3fa4.js";import"./point-e4ec110e.js";import"./rafaction-bba7928b.js";import"./transformhelper-ebad0156.js";import"./layouthelper-dc0e1370.js";import"./positiontracker-1fe0834d.js";import"./branch-bf06b0d2.js";import"./property-d3853089.js";import"./custom-element-267f9a21.js";import"./lit-element-70cf14f4.js";import"./capturemanager-86a8762a.js";import"./logicaltreehelper-bc8e12d3.js";import"./dx-ui-element-7f5e2dd2.js";import"./lit-element-base-7a85dca5.js";import"./nameof-factory-64d95f5b.js";import"./custom-events-helper-18f7786a.js";class g{static throttle(t,e){let i=!1,n=null,s=this;return function o(r){if(i)return n=r,void(s=this);t.apply(this,[r]),i=!0,setTimeout((()=>{i=!1,n&&(o.apply(s,[n]),n=null)}),e)}}}var A,v,C;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(A||(A={})),function(t){t[t.None=0]="None",t[t.AppointmentEditForm=1]="AppointmentEditForm",t[t.AppointmentCompactEditForm=2]="AppointmentCompactEditForm",t[t.AppointmentToolTip=3]="AppointmentToolTip",t[t.RecurrentAppointmentEditForm=4]="RecurrentAppointmentEditForm",t[t.RecurrentAppointmentDeleteForm=5]="RecurrentAppointmentDeleteForm",t[t.GotoDateForm=6]="GotoDateForm"}(v||(v={})),function(t){t[t.None=0]="None",t[t.Auto=1]="Auto",t[t.Always=2]="Always"}(C||(C={}));class y{getContainerIndex(t){return y.getAttributeIntValue(t,"data-container-index",-1)}getFirstContainerIndex(t){return y.getAttributeIntValue(t,"data-first-container-index",-1)}getLastContainerIndex(t){return y.getAttributeIntValue(t,"data-last-container-index",-1)}getAppointmentFirstCellIndex(t){return y.getAttributeIntValue(t,"data-first-cell-index",-1)}getAppointmentLastCellIndex(t){return y.getAttributeIntValue(t,"data-last-cell-index",-1)}getAppointmentColumnsCount(t){return y.getAttributeIntValue(t,"data-columns-count",0)}setAppointmentColumnsCount(t,e){t.setAttribute("data-columns-count",e)}getAppointmentColumn(t){return y.getAttributeIntValue(t,"data-column",0)}setAppointmentColumn(t,e){t.setAttribute("data-column",e)}getAppointmentRow(t){return y.getAttributeFloatValue(t,"data-row",-1)}getAppointmentRowSpan(t){return y.getAttributeFloatValue(t,"data-row-span",0)}getAppointmentKey(t){return t.getAttribute("data-key")||""}getStart(t){const e=new Date(parseInt(t.getAttribute("data-start")||"")),i=e.getTime()+6e4*e.getTimezoneOffset();return new Date(i)}getEnd(t){const e=new Date(parseInt(t.getAttribute("data-end")||"")),i=e.getTime()+6e4*e.getTimezoneOffset();return new Date(i)}getDuration(t){return parseInt(t.getAttribute("data-duration")||"")}getAppointmentEnd(t){const e=this.getStart(t),i=this.getDuration(t);return new Date(e.getTime()+i)}getAllDay(t){return""===t.getAttribute("data-allday")}getResourceKey(t){return t.getAttribute("data-resource")||""}static getAttributeIntValue(t,e,i){return y.getAttributeParsedNumberValue(t,e,parseInt,i)}static getAttributeFloatValue(t,e,i){return y.getAttributeParsedNumberValue(t,e,parseFloat,i)}static getAttributeParsedNumberValue(t,e,i,n){const s=t.getAttribute(e);return s?i(s):n}}const T="dxbs-sc-timecells-container",I="dxbs-sc-vertical-apt",b="dxbs-sc-horizontal-apt",w="dxbs-apt-edited",S="dxbs-sc-time-cell",E="dxsc-today";class D{static getVerticalAppointmentsContainer(t){return t.querySelectorAll(".dxbs-sc-vertical-apts")[0]}static getHorizontalAppointmentsContainer(t){return t.querySelectorAll(".dxbs-sc-horizontal-apts")[0]}static getHorizontalAppointments(t){const e=t.querySelectorAll(`.${b}`);return Array.from(e)}static getHorizontalEditableAppointments(t){const e=t.querySelectorAll(`.${b}.${w}`);return Array.from(e)}static getVerticalAppointments(t){const e=t.querySelectorAll(`.${I}`);return Array.from(e)}static getVerticalEditableAppointments(t){const e=t.querySelectorAll(`.${I}.${w}`);return Array.from(e)}static getHorizontalView(t){return t.querySelectorAll(".dxbs-sc-horizontal-view")[0]}static getTimeMarkerWrappers(t){return t.querySelectorAll(".dxbs-sc-time-marker-wrapper")}static getTimeMarkerContainer(t){return t.querySelectorAll(".dxbs-sc-time-marker")[0]}static getTimeMarkerImages(t){const e=t.querySelectorAll(".dxbs-sc-time-marker-image");return Array.from(e)}static getTimeMarkerLine(t){return t.querySelectorAll(".dxbs-sc-time-marker-line")[0]}static getTimeIndicatorContainer(t){return t.querySelectorAll(".dxbs-sc-time-indicator")[0]}static getAppointmentContainer(t){return n(t,"dxbs-sc-apt")}static getTimeCellContainer(t){return s(t,"",(function(t,e){return D.isTimeCellElement(t)}))}static getSelectedAppointment(t){return t.querySelectorAll(".dxbs-apt-selected:not(.dxbs-apt-disable)")[0]}static getEditableAppointments(t){const e=t.querySelectorAll(`.${w}`);return Array.from(e)}static isEditableAppointment(e){return t.DomUtils.hasClassName(e,w)}static getCellSelectionContainer(t){return t.querySelectorAll(".dxsc-cell-selection")[0]}static getVerticalResourceHeaders(t){return t.querySelectorAll(".dxsc-v-resource-header")}static getDateHeaders(t){const e=D.isMonthView(t)?S:"dxbs-sc-date-hr";return t.querySelectorAll(`.${e}`)}static getResourcesViewport(t){return t.querySelectorAll(".dxbs-sc-resources-container")[0]}static getTimescaleViewport(t){return t.querySelectorAll(".dxbs-sc-headers-container")[0]}static getTimeCellsViewport(t){return t.querySelectorAll(`.${T}`)[0]}static getParentTimeCellsViewport(t){return n(t,T)}static getHorizontalScrollSpacer(t){return t.querySelectorAll(".dxbs-sc-h-scroll-spacer")[0]}static getVerticalScrollSpacer(t){return t.querySelectorAll(".dxbs-sc-v-scroll-spacer")[0]}static isVerticalAppointment(e){return t.DomUtils.hasClassName(e,I)}static isHorizontalAppointment(e){return t.DomUtils.hasClassName(e,b)}static isTimeCellElement(e){return t.DomUtils.hasClassName(e,"dxbs-sc-all-day-area")||t.DomUtils.hasClassName(e,S)}static isTimelineView(e){return t.DomUtils.hasClassName(e,"dxbs-sc-timeline")}static isMonthView(e){return t.DomUtils.hasClassName(e,"dxbs-sc-month")}static isTopHandleElement(e){return t.DomUtils.hasClassName(e,"dxsc-top-handle")}static isBottomHandleElement(e){return t.DomUtils.hasClassName(e,"dxsc-bottom-handle")}static isLeftHandleElement(e){return t.DomUtils.hasClassName(e,"dxsc-left-handle")}static isRightHandleElement(e){return t.DomUtils.hasClassName(e,"dxsc-right-handle")}static isAppointmentSelected(e){return t.DomUtils.hasClassName(e,"dxbs-apt-selected")}static isDateCellHeader(e){return t.DomUtils.hasClassName(e,"dxsc-date-cell-head")}}D.Attr=new y;class x{constructor(t,e){this._element=t,this._cellSelector=e,this.containers=null,this.timeCells=null}get element(){return this._element}get cellSelector(){return this._cellSelector}getContainers(){if(!this.containers){const t=this.getTimeCells();this.containers={};for(let e,i=0;e=t[i];i++){const t=D.Attr.getContainerIndex(e);this.containers[t]||(this.containers[t]={cells:[]}),this.containers[t].cells.push(e)}}return this.containers}clearObjects(){this.timeCells=null,this.containers=null}getTimeCells(){return this.timeCells||(this.timeCells=this.element.querySelectorAll(this.cellSelector)),this.timeCells}getFirstContainer(){const t=this.getContainers();for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}findCell(t){const e=this.getContainers();for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(let n,s=0;n=e[i].cells[s];s++){const e=D.Attr.getStart(n),i=D.Attr.getEnd(n);if(e.valueOf()-t.valueOf()<=0&&t.valueOf()-i.valueOf()<0)return n}return null}findStartCell(t){const e=this.getContainers();for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(let n,s=0;n=e[i].cells[s];s++){const e=D.Attr.getStart(n);if(t.valueOf()-e.valueOf()<=0)return n}return null}findEndCell(t){const e=this.getContainers();for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(let n,s=0;n=e[i].cells[s];s++){const e=D.Attr.getEnd(n);if(t.valueOf()-e.valueOf()<=0)return n}return null}findCellByPos(t,e){const i=this.getTimeCells();for(let n,s=0;n=i[s];s++){const i=n.getBoundingClientRect();if(i.top<=e&&e<i.bottom&&i.left<=t&&t<i.right)return n}return null}}class H{constructor(t,e){this.start=t,this.duration=e,this.isLongerOrEqualDay=e>=O.DaySpan}getStart(){return this.start}getDuration(){return this.duration}getEnd(){return O.addTimeSpan(this.start,this.duration)}intersectsWith(t){return t.getEnd().valueOf()-this.getStart().valueOf()>=0&&t.getStart().valueOf()-this.getEnd().valueOf()<=0}}class V{constructor(t,e,i){this.id=t,this.views=e,this.interval=i,this.allDay=D.Attr.getAllDay(e[0]),this.resourceKey=D.Attr.getResourceKey(e[0]),this.sourceView=this.views[0].cloneNode(!0),this.aptCont=this.views[0].parentElement}getStart(){return this.interval.start}getDuration(){return this.interval.duration}getEnd(){return O.dateIncreaseWithUtcOffset(this.getStart(),this.getDuration())}clearViews(){this.views.forEach((t=>{t.parentElement&&t.parentElement.removeChild(t)})),this.views=[]}static createItem(t,e){return new V(t,e,V.getAppointmentInterval(e))}static getAppointmentInterval(t){const e=D.Attr.getStart(t[0]),i=D.Attr.getDuration(t[0]);return new H(e,i)}static createItems(t){const e={};for(let i,n=0;i=t[n];n++){const t=D.Attr.getAppointmentKey(i);e[t]||(e[t]=[]),e[t].push(i)}const i=[];for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(V.createItem(t,e[t]));return i}}class O{static dateSubsWithTimezone(t,e){return t.valueOf()-e.valueOf()+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}static truncToDate(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}static calculateDaysDifference(t,e){const i=O.truncToDate(t),n=O.truncToDate(e);return O.dateSubsWithTimezone(n,i)/O.DaySpan}static dateIncreaseWithUtcOffset(t,e){const i=O.dateIncrease(t,e),n=6e4*(i.getTimezoneOffset()-t.getTimezoneOffset());return O.dateIncrease(i,n)}static dateIncrease(t,e){return new Date(t.valueOf()+e)}static addTimeSpan(t,e){return new Date(t.valueOf()+e)}static toDayTime(t){return t.valueOf()-O.truncToDate(t).valueOf()}static getCellInterval(t){const e=D.Attr.getStart(t),i=D.Attr.getEnd(t);return new H(e,i.valueOf()-e.valueOf())}static dateTimeComparer(t,e){const i=e.getTime()-t.getTime();return 0===i?0:i<0?1:-1}static dateTimeIndexComparer(t,e,i){return O.dateTimeComparer(t[e],i)}}O.HalfHourSpan=18e5,O.DaySpan=864e5;class z{constructor(){this.TIMEOUT=6e4,this.subscriptions=[],this.timerId=-1}subscribe(t,e){if(-1===this.getSubscriptionIndex(t)){this.subscriptions.push({scheduler:t,updateAction:e}),-1===this.timerId&&this.startTimer()}}unsubscribe(t){const e=this.getSubscriptionIndex(t);-1!==e&&this.unsubscribeByIndex(e),0===this.subscriptions.length&&this.stopTimer()}unsubscribeByIndex(t){this.subscriptions.splice(t,1)}getSubscriptionIndex(t){for(let e,i=0;e=this.subscriptions[i];i++)if(e.scheduler===t)return i;return-1}startTimer(){this.timerId=setTimeout(this.onTimeout.bind(this),this.TIMEOUT)}stopTimer(){-1!==this.timerId&&(clearTimeout(this.timerId),this.timerId=-1)}onTimeout(){for(let t,e=0;t=this.subscriptions[e];e++)if(z.isElementValid(t.scheduler))try{t.updateAction()}catch(t){}else this.unsubscribeByIndex(e),e--;this.startTimer()}static isElementValid(t){for(;null!=t;){if("BODY"===t.tagName)return!0;t=t.parentNode}return!1}}class k{constructor(t,e){this.start=t,this.end=e}containsExcludeEndBound(t){return this.start<=t&&this.end>t}}function M(t,e,i){const n=t[e];return n===i?0:n<i?-1:1}function N(t,e,i,n,s){i||(i=M);let o=null==n?0:n;null==s&&(s=t.length-o);let r=o+s-1;for(;o<=r;){const n=o+(r-o>>1),s=i(t,n,e);if(0===s)return n;s<0?o=n+1:r=n-1}return-(o+1)}var j,B;!function(t){t[t.None=0]="None",t[t.DragAppointment=1]="DragAppointment",t[t.DragAppointmentStart=2]="DragAppointmentStart",t[t.DragAppointmentEnd=3]="DragAppointmentEnd",t[t.DragNewAppointment=4]="DragNewAppointment"}(j||(j={})),function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom"}(B||(B={}));class F{constructor(t){this.onMouseMoveHandler=this.onMouseMove.bind(this),this.onMouseMoveInternalHandler=this.onMouseMoveInternal.bind(this),this.scheduler=t,this.schedulerView=null,this.appointmentInfo=null,this.sourceAppointmentInfo=null,this.startCellInfo=null,this.currentCellInfo=null,this.dateDiff=0,this.horizontalAppointmentDragged=!1,this.lastCellChanged=!1,this.initialPageY=0,this.initialTop=0,this.initialScrollTop=0,this.lastTop=0,this.lastCell=null,this.direction=B.Top,this.mode=j.None,this.throttledDrag=g.throttle(this.onMouseMoveInternalHandler,20)}dragAppointmentStart(t,e,i){this.mode=j.DragAppointmentStart,this.startDrag(t,e,i)}dragAppointmentEnd(t,e,i){this.mode=j.DragAppointmentEnd,this.startDrag(t,e,i)}dragAppointment(t,e,i){var n,s;this.mode=j.DragAppointment,this.startDrag(t,e,i),null===(s=null===(n=this.schedulerView)||void 0===n?void 0:n.getScrollViewer())||void 0===s||s.startAutoScrolling(d.Horizontal)}dragNewAppointment(t){this.mode=j.DragNewAppointment,this.startDragNewAppointment(t)}dropAppointment(){var t,e,i,n;this.mode!==j.None&&(this.scheduler.removeEventListener("pointermove",this.onMouseMoveHandler),null===(e=null===(t=this.schedulerView)||void 0===t?void 0:t.getScrollViewer())||void 0===e||e.stopAutoScrolling(),this.schedulerView=null,this.mode===j.DragNewAppointment?null===(i=this.getUIHandlersBridge())||void 0===i||i.send("dropNewAppointment",""):(this.removeAppointmentTopPositionInfo(),null===(n=this.getUIHandlersBridge())||void 0===n||n.send("dropAppointment","")),this.mode=j.None)}startDrag(t,e,i){var n;this.beforeStart(e),this.appointmentInfo=new V(t.id,t.views,t.interval),this.sourceAppointmentInfo=t,this.currentCellInfo=e,this.dateDiff=t.getStart().valueOf()-e.interval.start.valueOf(),this.horizontalAppointmentDragged=e.layoutType===A.Horizontal,this.initialTop=this.findAppointmentViewByInterval(this.appointmentInfo.views,e.interval).offsetTop,this.initialPageY=i.pageY,this.lastTop=this.initialTop,this.lastCell=e.cell,this.initialScrollTop=this.getViewportScrollTop(),this.saveAppointmentTopPositionInfo(),null===(n=this.getUIHandlersBridge())||void 0===n||n.send("startDragAppointment",{key:t.id,resize:this.mode===j.DragAppointmentStart||this.mode===j.DragAppointmentEnd})}startDragNewAppointment(t){this.beforeStart(t);const e=t.interval.start,i=O.dateIncreaseWithUtcOffset(e,t.interval.duration),n=6e4*e.getTimezoneOffset()*-1;this.dispatchEvent("startDragNewAppointment",O.addTimeSpan(e,n),O.addTimeSpan(i,n),t.allDay,D.Attr.getResourceKey(t.cell))}beforeStart(t){this.startCellInfo=t,this.scheduler.addEventListener("pointermove",this.onMouseMoveHandler)}onMouseMove(t){this.mode!==j.None&&this.throttledDrag(t)}onMouseMoveInternal(t){var e;const i=null===(e=this.getSchedulerView())||void 0===e?void 0:e.findCellByCoordinates(t.clientX,t.clientY);if(!i)return;this.scheduler.getSelectedAppointmentInfo()&&(this.mode===j.DragNewAppointment?this.resizeNewAppointment(i):this.mode===j.DragAppointment?this.drag(i,t):this.resize(i,this.mode===j.DragAppointmentStart))}drag(t,e){var i;if(!(this.startCellInfo&&this.currentCellInfo&&this.appointmentInfo&&this.sourceAppointmentInfo))return;const n=this.currentCellInfo.interval;this.lastCellChanged=!1,this.updateEditedAppointmentPosition(e);const s=t.cell;if(this.lastCellChanged=this.lastCell!==s,this.lastCell=s,t.layoutType===A.Horizontal&&!this.horizontalAppointmentDragged){const t=(null===(i=s.offsetParent)||void 0===i?void 0:i.getBoundingClientRect().top)||0;this.initialTop=e.clientY-t,this.initialPageY=e.pageY,this.initialScrollTop=this.getViewportScrollTop(s),this.lastTop=this.initialTop}const o=t.interval;if(n.start.valueOf()-o.start.valueOf()==0&&n.duration===o.duration){const t=D.Attr.getResourceKey(s);if(!this.appointmentInfo.resourceKey||this.appointmentInfo.resourceKey===t)return}if(this.currentCellInfo.allDay!==t.allDay)this.dateDiff=0,this.appointmentInfo.interval=t.allDay?this.sourceAppointmentInfo.allDay?new H(o.start,this.sourceAppointmentInfo.interval.duration):o:this.startCellInfo.allDay?o:new H(o.start,this.sourceAppointmentInfo.interval.duration),this.appointmentInfo.allDay=t.allDay;else{let t=O.addTimeSpan(o.start,this.dateDiff||0);this.appointmentInfo.allDay&&(t=O.truncToDate(t)),this.appointmentInfo.interval=new H(t,this.appointmentInfo.interval.duration)}this.updateResource(s),this.saveAppointmentTopPositionInfo();const r=6e4*o.start.getTimezoneOffset()*-1;this.dispatchEvent("dragAppointment",O.addTimeSpan(this.appointmentInfo.getStart(),r),O.addTimeSpan(this.appointmentInfo.getEnd(),r),this.appointmentInfo.allDay,this.appointmentInfo.resourceKey),this.currentCellInfo=t}resize(t,e){if(!this.appointmentInfo||!this.currentCellInfo||!this.sourceAppointmentInfo)return;const i=t.interval,n=this.currentCellInfo.interval;if(n.start.valueOf()-i.start.valueOf()==0&&n.duration===i.duration||n.isLongerOrEqualDay!==i.isLongerOrEqualDay)return;if(e){const t=this.sourceAppointmentInfo.interval.duration+(this.sourceAppointmentInfo.interval.start.valueOf()-i.start.valueOf());t>=0&&(this.appointmentInfo.interval=new H(i.start,t))}else this.appointmentInfo.interval.duration=i.start.valueOf()+i.duration-this.sourceAppointmentInfo.interval.start.valueOf();this.updateResource(this.currentCellInfo.cell);const s=6e4*i.start.getTimezoneOffset()*-1;this.dispatchEvent("dragAppointment",O.addTimeSpan(this.appointmentInfo.getStart(),s),O.addTimeSpan(this.appointmentInfo.getEnd(),s),this.appointmentInfo.allDay,this.appointmentInfo.resourceKey),this.currentCellInfo=t}resizeNewAppointment(t){if(!this.startCellInfo)return;const e=t.interval,i=e.start.valueOf()-this.startCellInfo.interval.start.valueOf();if(0===i&&this.startCellInfo.interval.duration===e.duration)return;i<0&&this.startCellInfo.interval.duration===e.duration?this.direction=B.Top:i>0&&this.startCellInfo.interval.duration===e.duration&&(this.direction=B.Bottom),this.direction===B.Bottom?this.startCellInfo.interval.duration=i+e.duration:this.direction===B.Top&&(this.startCellInfo.interval.start=e.start,this.startCellInfo.interval.duration+=-1*i);const n=this.startCellInfo.interval.start,s=O.dateIncreaseWithUtcOffset(n,this.startCellInfo.interval.duration),o=D.Attr.getResourceKey(t.cell),r=6e4*n.getTimezoneOffset()*-1;this.dispatchEvent("dragAppointment",O.addTimeSpan(n,r),O.addTimeSpan(s,r),t.allDay,o)}dispatchEvent(t,e,i,n,s){var o;null===(o=this.getUIHandlersBridge())||void 0===o||o.send(t,{start:e,end:i,isAllDay:n,resourceKey:s})}getUIHandlersBridge(){return this.scheduler.uiHandlersBridge}getSchedulerView(){return null===this.schedulerView&&(this.schedulerView=this.scheduler.getView()),this.schedulerView}findAppointmentViewByInterval(t,e){return t.find((t=>{if(e&&t.firstCell&&t.lastCell){const i=O.getCellInterval(t.firstCell).getStart(),n=O.getCellInterval(t.lastCell).getEnd();if(e.intersectsWith(new H(i,n.valueOf()-i.valueOf())))return t}}))}updateEditedAppointmentPosition(t){const e=this.scheduler.getEditableAppointments();if(!this.lastCell||0===e.length||!this.currentCellInfo)return;const i=this.findAppointmentViewByInterval(e,this.currentCellInfo.interval);if(!i)return;if(!D.isHorizontalAppointment(i))return void(this.horizontalAppointmentDragged=!1);let n=!1;if(this.horizontalAppointmentDragged||(this.initialTop-=i.offsetHeight/2,this.lastTop=this.initialTop,this.horizontalAppointmentDragged=!0,n=!0),t){const e=this.getViewportScrollTop(),i=t.pageY-this.initialPageY+(e-this.initialScrollTop);this.lastTop=this.initialTop+i,n=n||0!==i}if(n||this.lastCellChanged){const t=this.lastCell.offsetTop+1;this.lastTop=Math.min(this.lastTop,t+this.lastCell.offsetHeight-i.offsetHeight-2),this.lastTop=Math.max(t,this.lastTop)}const s=this.lastTop-this.lastCell.offsetTop;e.forEach((t=>{const e=t,i=e.firstCell,n=i.offsetTop+i.offsetHeight-e.offsetHeight-2;let o=i.offsetTop+s;o>=n&&(o=n),e.style.top=o+"px",e.style.zIndex="1000"}))}saveAppointmentTopPositionInfo(){var t;if(!this.lastCell)return;const e=this.lastTop-this.lastCell.offsetTop;null===(t=this.getSchedulerView())||void 0===t||t.setAttribute("data-appointment-top-position",e.toString())}removeAppointmentTopPositionInfo(){var t;null===(t=this.getSchedulerView())||void 0===t||t.removeAttribute("data-appointment-top-position")}updateResource(t){this.appointmentInfo&&this.appointmentInfo.resourceKey&&(this.appointmentInfo.resourceKey=D.Attr.getResourceKey(t))}getViewportScrollTop(t){const e=t||this.lastCell;if(!e)return 0;const i=D.getParentTimeCellsViewport(e);return(null==i?void 0:i.scrollTop)||0}}const P=f.toUpperCase();const R="dxbl-scheduler";class K extends e{constructor(){super(),this.onClickEventHandler=this.onDelayedClickEvent.bind(this),this.onDoubleClickEventHandler=this.onDoubleClickEvent.bind(this),this.onDragStartEventHandler=this.onDragStartEvent.bind(this),this.onDragStopEventHandler=this.onDragStopEvent.bind(this),this.unforcedFunctions={},this.appointmentDragController=new F(this),this.allowCreateAppointment=!1,this.allowEditAppointment=!1,this.allowDragAppointment=!1,this.allowResizeAppointment=!1,this.enableAppointmentTooltip=!1,this.activeFormType=v.None,this.handlePointerEventsMode=l.Click|l.DblClick|l.Dragging}initializeComponent(){super.initializeComponent(),this.uiHandlersBridge=this.querySelector(i),this.addEventSubscriptions(),this.adjustControl()}disposeComponent(){delete this.uiHandlersBridge,this.removeEventSubscriptions(),super.disposeComponent()}getView(){return this.querySelector("dxbl-view")}adjustControl(){var t;null===(t=this.getView())||void 0===t||t.adjust()}addEventSubscriptions(){this.addEventListener(a.eventName,this.onClickEventHandler),this.addEventListener(p.eventName,this.onDoubleClickEventHandler),this.addEventListener(c.eventName,this.onDragStartEventHandler),this.addEventListener(u.eventName,this.onDragStopEventHandler),this.elementContentSizeSubscription=o(this,this.adjustControl.bind(this))}removeEventSubscriptions(){this.removeEventListener(a.eventName,this.onClickEventHandler),this.removeEventListener(p.eventName,this.onDoubleClickEventHandler),this.removeEventListener(c.eventName,this.onDragStartEventHandler),this.removeEventListener(u.eventName,this.onDragStopEventHandler),this.elementContentSizeSubscription&&r(this.elementContentSizeSubscription)}onClickEvent(t){var e,i,n,s,o,r;const l=t.detail.source.target,a=D.getAppointmentContainer(l);if(!(null===(e=this.getView())||void 0===e?void 0:e.getEditableAppointmentKey())||a&&(null===(i=this.getView())||void 0===i?void 0:i.getEditableAppointmentKey())===D.Attr.getAppointmentKey(a))if(a)D.isAppointmentSelected(a)||this.selectAppointment(a),this.enableAppointmentTooltip&&(null===(s=this.getView())||void 0===s?void 0:s.getEditableAppointmentKey())!==D.Attr.getAppointmentKey(a)&&(null===(o=this.uiHandlersBridge)||void 0===o||o.send("showAppointmentToolTip","")),t.stopPropagation();else if(this.activeFormType===v.None){const e=D.getTimeCellContainer(l);this.allowCreateAppointment&&e&&(this.createAppointmentByTimeCell(e),t.stopPropagation())}else null===(r=this.uiHandlersBridge)||void 0===r||r.send("hideAppointmentToolTip",{outsideClick:!1});else null===(n=this.uiHandlersBridge)||void 0===n||n.send("hideAppointmentToolTip",{outsideClick:!1})}onDelayedClickEvent(t){this.unforcedFunctionCall(this.onClickEvent.bind(this,t),"ClickEvent",200,!0)}onDoubleClickEvent(t){const e=D.getAppointmentContainer(t.detail.source.target),i=this.getView();e&&i&&i.getEditableAppointmentKey()!==D.Attr.getAppointmentKey(e)&&(D.isAppointmentSelected(e)||this.selectAppointment(e),this.clearUnforcedFunctionByKey("ClickEvent"))}onDragStartEvent(t){var e,i;const n=t.detail.source.target;if(!n||(null===(e=this.getView())||void 0===e?void 0:e.getEditableAppointmentKey()))return;const s=null===(i=this.getView())||void 0===i?void 0:i.findCellByCoordinates(t.detail.source.clientX,t.detail.source.clientY);if(!s)return;const o=D.getAppointmentContainer(n);if(o){const e=this.getAppointmentInfo(D.Attr.getAppointmentKey(o));this.allowEditAppointment&&e&&(this.allowResizeAppointment&&(D.isTopHandleElement(n)||D.isLeftHandleElement(n))?this.appointmentDragController.dragAppointmentStart(e,s,t.detail.source):this.allowResizeAppointment&&(D.isBottomHandleElement(n)||D.isRightHandleElement(n))?this.appointmentDragController.dragAppointmentEnd(e,s,t.detail.source):this.allowDragAppointment&&this.appointmentDragController.dragAppointment(e,s,t.detail.source))}else this.allowCreateAppointment&&this.allowResizeAppointment&&this.appointmentDragController.dragNewAppointment(s);t.stopPropagation()}onDragStopEvent(t){this.appointmentDragController.dropAppointment(),t.stopPropagation()}selectAppointment(e){var i;e&&(t.DomUtils.addClassName(e,"dxbs-apt-selected"),null===(i=this.uiHandlersBridge)||void 0===i||i.send("selectAppointment",{key:D.Attr.getAppointmentKey(e)}))}createAppointmentByTimeCell(t){var e;const i=D.Attr.getStart(t),n=D.Attr.getEnd(t),s=6e4*i.getTimezoneOffset()*-1;null===(e=this.uiHandlersBridge)||void 0===e||e.send("createAppointment",{appointmentInfo:{start:O.addTimeSpan(i,s),end:O.addTimeSpan(n,s),isAllDay:D.Attr.getAllDay(t),resourceKey:D.Attr.getResourceKey(t)}})}getSelectedAppointmentInfo(){const t=D.getSelectedAppointment(this);return t?this.getAppointmentInfo(D.Attr.getAppointmentKey(t)):null}getAppointmentInfo(t){const e=this.getView();return e?e.appointmentInfos.filter((e=>e.id===t))[0]:null}getEditableAppointments(){return D.getEditableAppointments(this)}static get observedAttributes(){return["allow-create-appointment","allow-edit-appointment","allow-drag-appointment","allow-resize-appointment","enable-appointment-tooltip","active-form-type"]}attributeChangedCallback(t,e,i){switch(t){case"allow-create-appointment":this.allowCreateAppointment=null!==i;break;case"allow-edit-appointment":this.allowEditAppointment=null!==i;break;case"allow-drag-appointment":this.allowDragAppointment=null!==i;break;case"allow-resize-appointment":this.allowResizeAppointment=null!==i;break;case"enable-appointment-tooltip":this.enableAppointmentTooltip=null!==i;break;case"active-form-type":this.activeFormType=parseInt(i)}}unforcedFunctionCall(t,e,i,n){n&&this.hasUnforcedFunction(e)&&this.clearUnforcedFunctionByKey(e),void 0===this.unforcedFunctions[e]&&(this.unforcedFunctions[e]=setTimeout((()=>{t(),delete this.unforcedFunctions[e]}),i))}hasUnforcedFunction(t){return!!this.unforcedFunctions[t]}clearUnforcedFunctionByKey(t){clearTimeout(this.unforcedFunctions[t]),delete this.unforcedFunctions[t]}}customElements.define(R,K),customElements.define("dxbl-appointment-tooltip",class extends e{constructor(){super(),this.scheduler=null}initializeComponent(){super.initializeComponent(),this.scheduler=t.DomUtils.getParentByTagName(this,R),this.scheduler&&(this.uiHandlersBridge=this.scheduler.querySelector(i),this.initEvents())}disposeComponent(){super.disposeComponent(),document.removeEventListener(m.TouchUtils.touchMouseDownEventName,this.toolTipLostFocusHandler)}initEvents(){this.toolTipLostFocusHandler=t=>{const e=D.getAppointmentContainer(t.srcElement);return!(e&&D.isAppointmentSelected(e)||!this.uiHandlersBridge)&&function(t,e,i,n){return function(t,e,i,n){let s=t.target;for(;s;){if(s===e||s.tagName===P||s===i)return!1;s=s.parentElement}n&&setTimeout((()=>{n()}),0);return!0}(t,e,n,(function(){e&&"string"!=typeof e&&"none"!==e.style.display&&(null==i||i.send("hideAppointmentToolTip",{outsideClick:!0}))}))}(t,this,this.uiHandlersBridge,this.scheduler)},document.addEventListener(m.TouchUtils.touchMouseDownEventName,this.toolTipLostFocusHandler)}}),customElements.define("dxbl-view",class extends e{constructor(){super(),this.hApts=[],this.vApts=[],this.appointmentInfos=[],this.editableAppointmentKey=""}initializeComponent(){super.initializeComponent(),this.timeMarkerUpdater=new z,this.scrollViewer=this.querySelector(`.${h.ClassName}`),this.addEventSubscriptions(),this.recalculateLayout()}disposeComponent(){this.removeEventSubscriptions(),super.disposeComponent()}addEventSubscriptions(){var t,e;null===(t=this.timeMarkerUpdater)||void 0===t||t.subscribe(this,this.updateTimeMarkers.bind(this)),null===(e=this.scrollViewer)||void 0===e||e.subscribeToScroll(this.viewportScrollViewerEventHandler.bind(this))}removeEventSubscriptions(){var t,e;null===(t=this.timeMarkerUpdater)||void 0===t||t.unsubscribe(this),null===(e=this.scrollViewer)||void 0===e||e.unsubscribeFromScroll()}recalculateLayout(){this.initDateHeaders(),this.initTimeCells(),this.initAppointments(!1),this.adjust()}recalculateAppointments(t,e){this.initAppointments(e),e?this.calculateEditableAppointments():this.calculateAppointments(t)}adjust(){this.calculateAppointments(!0),this.updateTimeMarkers()}findCellByCoordinates(t,e){var i,n;let s=A.Vertical,o=null===(i=this.vView)||void 0===i?void 0:i.findCellByPos(t,e);return o||(o=null===(n=this.hView)||void 0===n?void 0:n.findCellByPos(t,e),s=A.Horizontal),o?{cell:o,layoutType:s,allDay:D.Attr.getAllDay(o),interval:O.getCellInterval(o)}:null}getEditableAppointmentKey(){return this.editableAppointmentKey}getScrollViewer(){return this.querySelector(`.${h.ClassName}`)}initTimeCells(){var t,e;null===(t=this.getHorizontalViewPart())||void 0===t||t.clearObjects(),null===(e=this.getVerticalViewPart())||void 0===e||e.clearObjects()}initAppointments(t){var e,i;this.hApts=t?D.getHorizontalEditableAppointments(this):D.getHorizontalAppointments(this),this.vApts=t?D.getVerticalEditableAppointments(this):D.getVerticalAppointments(this),this.prepareAppointments(null===(e=this.hView)||void 0===e?void 0:e.getTimeCells(),this.hApts),this.prepareAppointments(null===(i=this.vView)||void 0===i?void 0:i.getTimeCells(),this.vApts),this.appointmentInfos=V.createItems(this.hApts),this.appointmentInfos=this.appointmentInfos.concat(V.createItems(this.vApts))}initDateHeaders(){const t=D.getDateHeaders(this),e=this.getCurrentLocalTime();t.forEach((t=>{const i=D.Attr.getStart(t),n=D.Attr.getEnd(t);n.valueOf()-i.valueOf()>O.DaySpan||(e.valueOf()-i.valueOf()>=0&&n.valueOf()-e.valueOf()>0?t.classList.add(E):t.classList.remove(E))}))}updateTimeMarkers(){var t,e;D.isTimelineView(this)?this.calculateHorizontalTimeMarker(this,null===(t=this.hView)||void 0===t?void 0:t.getFirstContainer()):this.calculateVerticalTimeMarkers(this,null===(e=this.vView)||void 0===e?void 0:e.getTimeCells())}calculateAppointments(t){var e;const i=null===(e=this.hView)||void 0===e?void 0:e.getContainers();i&&(this.resetCalculationInfo(),t?this.calculateHorizontalAppointmentsAndCells(this,i):this.calculateHorizontalAppointments(i)),this.calculateVerticalAppointments(this.vApts),t&&this.calculateScrollingSpacers(this)}calculateEditableAppointments(){var t;if(null===(t=this.hView)||void 0===t?void 0:t.getContainers()){this.resetCalculationInfo();for(let t,e=0;t=this.hApts[e];e++){this.calculateHorizontalAppointmentCore(t);const e=this.getAttribute("data-appointment-top-position"),i=e?parseInt(e):0;t.style.top=t.firstCell.offsetTop+i+"px"}}this.calculateVerticalAppointments(this.vApts)}calculateVerticalAppointments(t){for(let e,i=0;e=t[i];i++)this.calculateVerticalAppointment(e)}calculateVerticalAppointment(t){const e=t.firstCell,i=(e.offsetWidth-10)/D.Attr.getAppointmentColumnsCount(t),n=D.Attr.getAppointmentRow(t)-D.Attr.getAppointmentFirstCellIndex(t),s=e.offsetTop+e.offsetHeight*n,o=D.Attr.getAppointmentColumn(t),r=e.offsetLeft+i*o,l=Math.floor(e.getBoundingClientRect().height*D.Attr.getAppointmentRowSpan(t));this.updateAppointmentCompactStyle(t,i),t.style.top=`${s}px`,t.style.left=`${r}px`,t.style.width=`${i}px`,t.style.height=`${l}px`,t.style.display=""}calculateScrollingSpacers(t){const e=D.getTimeCellsViewport(t);if(!e)return;let i=0;e.scrollWidth!==e.offsetWidth&&(i=e.offsetHeight-e.clientHeight);let n=0;e.scrollHeight!==e.offsetHeight&&(n=e.offsetWidth-e.clientWidth);const s=D.getHorizontalScrollSpacer(t);s&&i&&(s.style.height=i+"px");const o=D.getVerticalScrollSpacer(t);o&&n&&(o.style.width=n+"px"),s&&(s.style.display=i?"block":""),o&&(o.style.display=n?"block":"")}prepareAppointments(t,e){if(!t)return;const i={};for(let e,n=0;e=t[n];n++){e.intersects=[];const t=D.Attr.getContainerIndex(e);i[t]||(i[t]=[]),i[t].push(e)}for(let t,n=0;t=e[n];n++){const e=D.Attr.getContainerIndex(t),n=D.Attr.getAppointmentFirstCellIndex(t),s=D.Attr.getAppointmentLastCellIndex(t);if(i[e]){t.firstCell=i[e][n],t.lastCell=i[e][s],t.info={cellCount:s-n+1};for(let o=n;o<=s;o++){this.addIntersect(i[e][o],t)}}}}calculateHorizontalAppointments(t){for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const i=t[e].cells;for(let t,e=0;t=i[e];e++)this.calculateHorizontalAppointmentsInCell(t)}}calculateHorizontalAppointmentsAndCells(t,e){const i=this.prepareResourceHeaders(t,e);for(const t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;let n=0;const s=e[t].cells;for(let t,e=0;t=s[e];e++){this.calculateHorizontalAppointmentsInCell(t);const e=this.getHorizontalCellHeight(t);e>n&&(n=e)}const o=s[0];let r=n?n+15:0;o.style.height="",r=Math.max(o.offsetHeight,r);const l=i[this.getElementResourceKey(o)];l&&(l.lastContainerIndex===t&&(r=Math.max(l.minHeight-l.height,r)),l.height+=r),o.style.height=r+"px"}for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t].element.style.height=i[t].height+"px")}calculateHorizontalAppointmentsInCell(t){const e=this.getCalculatedHorizontalAppointmentsInCell(t),i=this.getNotCalculatedHorizontalAppointmentsInCell(t);e.forEach((t=>t.calculated=!0)),i.forEach((t=>t.calculated=!1)),this.calculateHorizontalAptsInCellCore(t,e.concat(i),e.length)}calculateHorizontalAptsInCellCore(t,e,i){this.calculateAppointmentRelativeTopOffset(e,i),this.calculateAppointmentsPosition(t,e)}calculateAppointmentsPosition(t,e){let i=t.offsetTop;if(t.lastElementChild&&D.isDateCellHeader(t.lastElementChild)){const e=window.getComputedStyle(t).paddingTop;i+=t.lastElementChild.offsetHeight+parseInt(e)}for(let t=0;t<e.length;t++){const n=e[t],s=n.relativePosition+i;n.info.calculatedTop=s,n.style.top=s+"px"}}calculateAppointmentRelativeTopOffset(t,e){this.adjustAppointmentCellIndexes(t),this.calculateAppointmentRelativePositionsCore(t,e)}adjustAppointmentCellIndexes(t){const e=this.createAptsDateTimeCollection(t);this.calculateAdjustedCellIndexes(t,e)}calculateAppointmentRelativePositionsCore(t,e){const i=t.length,n=this.createBusyIntervals(2*i);let s=0;for(;s<e;)this.makeIntervalBusy(t[s],n),s++;for(;s<i;){const e=t[s];if(this.calculateHorizontalAppointmentCore(e),!e.calculated){const t=this.findAvailableRelativePosition(e,n);e.relativePosition=t}this.makeIntervalBusy(e,n),s++}}createAptsDateTimeCollection(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i],{startTime:s,endTime:o}=this.getAptAdjustedStartEndTime(n);this.addDateTime(e,s),this.addDateTime(e,o)}return e.sort(O.dateTimeComparer),e}calculateAdjustedCellIndexes(t,e){for(let i=0;i<t.length;i++)this.calculateAdjustedCellIndexesCore(t[i],e)}calculateAdjustedCellIndexesCore(t,e){const{startTime:i,endTime:n}=this.getAptAdjustedStartEndTime(t),s=N(e,i,O.dateTimeIndexComparer),o=N(e,n,O.dateTimeIndexComparer)-1;t.info.busyIntervalFirstCellIndex=s,t.info.busyIntervalLastCellIndex=o}getAptAdjustedStartEndTime(t){const e=this.getSnapToCellsMode(),i=D.Attr.getAppointmentFirstCellIndex(t),n=D.Attr.getAppointmentLastCellIndex(t),s=e===C.Always||e===C.Auto&&i-n<=1;return{startTime:D.Attr.getStart(s?t.firstCell:t),endTime:s?D.Attr.getEnd(t.lastCell):D.Attr.getAppointmentEnd(t)}}getSnapToCellsMode(){const t=this.getAttribute("snap-to-cells-mode");return null===t?null:C[t]}findAvailableRelativePosition(t,e){t.relativePosition=0;let i=0;const n=t.info.busyIntervalFirstCellIndex,s=t.info.busyIntervalLastCellIndex;let o=n;for(;o<=s;){const s=this.findPossibleIntersectionInterval(e[o],i);null===s||s.start>=i+t.offsetHeight?o++:(i=s.end,o=n)}return i}findPossibleIntersectionInterval(t,e){for(let i=0;i<t.length;i++){const n=t[i];if(n.containsExcludeEndBound(e)||n.start>e)return new k(n.start,n.end)}return null}createBusyIntervals(t){const e=[];for(let i=0;i<t;i++)e.push([]);return e}makeIntervalBusy(t,e){const i=t.info.busyIntervalLastCellIndex;for(let n=t.info.busyIntervalFirstCellIndex;n<=i;n++)this.addBusyInterval(e[n],new k(t.relativePosition,t.relativePosition+t.offsetHeight))}addBusyInterval(t,e){if(!this.checkBusyIntervalExists(t,e)){let i=t.findIndex((t=>t.start>e.start));-1===i&&(i=t.length),t.splice(i,0,e)}}checkBusyIntervalExists(t,e){return t.some((t=>t.start===e.start&&t.end===e.end))}addDateTime(t,e){this.isAlreadyAdded(t,e)||t.push(e)}isAlreadyAdded(t,e){const i=t.length;for(let n=0;n<i;n++)if(t[n].valueOf()===e.valueOf())return!0;return!1}getCalculatedHorizontalAppointmentsInCell(t){return t.intersects.filter((t=>void 0!==t.info.calculatedTop)).sort(((t,e)=>t.info.calculatedTop-e.info.calculatedTop))}getNotCalculatedHorizontalAppointmentsInCell(t){return t.intersects.filter((t=>void 0===t.info.calculatedTop)).sort(((t,e)=>{const i=e.info.cellCount-t.info.cellCount;return i||D.Attr.getStart(t).valueOf()-D.Attr.getStart(e).valueOf()}))}calculateHorizontalAppointmentCore(t){const e=t.firstCell,i=e.getBoundingClientRect().width,n=D.Attr.getAppointmentRow(t)-D.Attr.getAppointmentFirstCellIndex(t),s=e.offsetLeft+Math.floor(i*n),o=Math.floor(i*D.Attr.getAppointmentRowSpan(t));this.updateAppointmentCompactStyle(t,o),t.style.height="",t.style.width=`${o}px`,t.style.left=`${s}px`,t.style.top="-10000px",t.style.display=""}getHorizontalCellHeight(t){let e=-1,i=null;return t.intersects.forEach((t=>{t.info.calculatedTop>e&&(e=t.info.calculatedTop,i=t)})),i?e-t.offsetTop+i.offsetHeight:0}prepareResourceHeaders(t,e){const i={};for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;const s=this.getElementResourceKey(e[n].cells[0]),o=this.findTimelineResourceHeader(t,s);o&&(o.style.height="",null==i[s]?i[s]={element:o,height:0,minHeight:0,lastContainerIndex:n}:i[s].lastContainerIndex=n)}for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t].minHeight=i[t].element.offsetHeight);return i}resetCalculationInfo(){for(let t,e=0;t=this.hApts[e];e++)t.info={cellCount:t.info.cellCount}}updateAppointmentCompactStyle(e,i){t.DomUtils.toggleClassName(e.children[0],"dxbs-sc-apt-compact",i<50)}addIntersect(t,e){const i=t.intersects;i.findIndex((t=>D.Attr.getAppointmentKey(t)===D.Attr.getAppointmentKey(e)))<0&&i.push(e)}calculateVerticalTimeMarkers(t,e){if(!e)return;const i=this.getCurrentLocalTime(),n=this.truncToDate(i),s=this.getTimeMarkerInfos(t);if(0!==s.length)for(let o,r=0;o=s[r];r++)this.calculateVerticalTimeMarker(o,t,e,n,i)}calculateVerticalTimeMarker(t,e,i,n,s){const o=t.wrapper,r=this.findCellsByTime(i,s,t.firstContainerIndex,t.lastContainerIndex);if(!r.length)return void(o.style.display="none");o.style.display="";const l=t.timeMarker,a=t.timeIndicator,p=l.offsetHeight/2,c=r[0].offsetLeft;let u=0;if(t.startFromContainer){const e=this.findFirstCellInContainer(i,t.firstContainerIndex);e&&(u=e.offsetLeft===c?c-p:e.offsetLeft)}const d=Math.floor(this.calculateTop(s,r[0],n));if(l.style.top=d-p+"px",l.style.left=u+"px",l.style.width=c-u+p+1+"px",this.isElementDisplayed(o)){let t=0;for(let e,i=0;e=r[i];i++)t+=e.offsetWidth;a.style.top=d-1+"px",a.style.width=t+"px",a.style.left=c+"px"}}getAdaptedContainerTime(t,e){const i=t,n=this.dateSubsWithTimezone(e,i);let s=Math.abs(n)%864e5;return n<0&&(s=864e5-s),this.dateIncreaseWithUtcOffset(i,s)}calculateTop(t,e,i){const n=this.getAdaptedContainerTime(i,t),s=D.Attr.getStart(e),o=D.Attr.getEnd(e),r=this.dateSubsWithTimezone(n,s);return e.offsetTop+e.offsetHeight*r/(o.valueOf()-s.valueOf())}calculateHorizontalTimeMarker(t,e){const i=D.getTimeMarkerImages(t),n=D.getTimeMarkerLine(t);if(!i.length||!n||!e)return;const s=this.getCurrentLocalTime(),o=e.cells[e.cells.length-1],r=D.Attr.getStart(e.cells[0]),l=D.Attr.getEnd(o).valueOf()-r.valueOf(),a=this.dateSubsWithTimezone(s,r)/l;if(a>0&&a<1){i.forEach((t=>{t.style.display="unset"})),n.style.display="unset";const t=Math.round(1e4*a)/100,e=n.offsetWidth/2,s=`calc(${t}% - ${i[0].offsetWidth/2}px)`;i.forEach((t=>{t.style.left=s})),n.style.left=`calc(${t}% - ${e}px)`}else i.forEach((t=>{t.style.display="none"})),n.style.display="none"}dateIncrease(t,e){return new Date(t.valueOf()+e)}dateIncreaseWithUtcOffset(t,e){const i=this.dateIncrease(t,e),n=6e4*(i.getTimezoneOffset()-t.getTimezoneOffset());return this.dateIncrease(i,n)}dateSubsWithTimezone(t,e){return t.valueOf()-e.valueOf()+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}truncToDate(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}isElementDisplayed(t){return t&&"none"!==t.style.display}findFirstCellInContainer(t,e){for(let i,n=0;i=t[n];n++)if(D.Attr.getContainerIndex(i)===e)return i;return null}findTimelineResourceHeader(t,e){if(""===e)return null;const i=D.getVerticalResourceHeaders(t);for(let t,n=0;t=i[n];n++)if(this.getElementResourceKey(t)===e)return t;return null}getTimeMarkerInfos(t){const e=[],i=D.getTimeMarkerWrappers(t);for(let t,n=0;t=i[n];n++){const i={wrapper:t,timeMarker:D.getTimeMarkerContainer(t),timeIndicator:D.getTimeIndicatorContainer(t),firstContainerIndex:D.Attr.getFirstContainerIndex(t),lastContainerIndex:D.Attr.getLastContainerIndex(t),startFromContainer:n>0};e.push(i)}return e}getCurrentLocalTime(){const t=(new Date).getTime();return new Date(t)}findCellsByTime(t,e,i,n){const s=[];for(let o,r=0;o=t[r];r++)D.Attr.getContainerIndex(o)<i||D.Attr.getContainerIndex(o)>n||e.valueOf()-D.Attr.getStart(o).valueOf()>=0&&D.Attr.getEnd(o).valueOf()-e.valueOf()>0&&s.push(o);return s}getHorizontalViewPart(){return this.hView||(this.hView=new x(this,".dxbs-sc-all-day-area, .dxbs-sc-horizontal-view .dxbs-sc-time-cell")),this.hView}getVerticalViewPart(){return this.vView||(this.vView=new x(this,".dxbs-sc-vertical-view .dxbs-sc-time-cell")),this.vView}getElementResourceKey(t){return D.Attr.getResourceKey(t)}viewportScrollViewerEventHandler(t,e){const i=D.getResourcesViewport(this);i&&(i.scrollTop=t);const n=D.getTimescaleViewport(this);n&&(n.scrollLeft=e)}static get observedAttributes(){return["state","editable-appointment-key","snap-to-cells-mode"]}attributeChangedCallback(t,e,i){if(this.isInitialized)switch(t){case"state":case"snap-to-cells-mode":setTimeout((()=>{this.editableAppointmentKey?this.recalculateAppointments(!this.editableAppointmentKey,!0):this.recalculateLayout()}),0);break;case"editable-appointment-key":this.editableAppointmentKey=i}}});const L={loadModule:function(){}};export{K as DxScheduler,R as DxSchedulerTagName,L as default};
