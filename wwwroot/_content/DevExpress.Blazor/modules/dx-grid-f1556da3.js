import{D as e}from"./dx-html-element-base-3906936e.js";import{C as t}from"./css-classes-f3f8ed66.js";import{S as n}from"./scroll-viewer-css-classes-af8d2aac.js";import{H as s,T as i,P as o,a as r,b as l,c as a}from"./dx-html-element-pointer-events-helper-4b46ddbf.js";import{DxUIHandlersBridgeTagName as d}from"./dx-ui-handlers-bridge-4076ae57.js";import{b as h,d as c}from"./dom-f93f7533.js";import{k as u}from"./key-4ced10e2.js";import{S as m,D as g,a as C}from"./dx-scroll-viewer-11139ffa.js";import{S as p}from"./svg-utils-0be6c8b2.js";import{T as v}from"./transformhelper-ebad0156.js";import{E as b}from"./eventhelper-8570b930.js";import{L as f}from"./layouthelper-dc0e1370.js";import{FocusableElementsSelector as y}from"./focus-utils-cd9c9bc2.js";import{D as S,E}from"./dom-utils-04e3c6d2.js";import{C as I}from"./custom-events-helper-18f7786a.js";import{T as x,B as w,V as R}from"./dx-virtual-scroll-viewer-3bf695e2.js";import"./data-qa-utils-8be7c726.js";import"./pointer-event-helper-ba4ce1e1.js";import"./constants-58283e53.js";import"./_tslib-6e8ca86b.js";import"./rect-00eb3fa4.js";import"./point-e4ec110e.js";import"./touch-b17c92da.js";import"./disposable-d2c2d283.js";import"./thumb-1c09cc55.js";class N{}N.ClassName=t.Prefix+"-grid",N.DataTableClassName=N.ClassName+"-table",N.DataTableNoScrollClassName=N.DataTableClassName+"-no-scroll",N.TopPanelClassName=N.ClassName+"-top-panel",N.BottomPanelClassName=N.ClassName+"-bottom-panel",N.PagerPanelClassName="dxbl-pager-container",N.GroupPanelContentContainerClassName=N.ClassName+"-group-panel-container",N.SearchBoxContainerClassName=N.ClassName+"-search-box-container",N.SearchBoxClassName=N.ClassName+"-search-box",N.EmptyHeaderCellContentContainerClassName=N.ClassName+"-empty-header",N.GroupContentFreeSpaceClassName=N.ClassName+"-group-panel-free-space",N.HeaderRowClassName=N.ClassName+"-header-row",N.EditRowClassName=N.ClassName+"-edit-row",N.FilterRowClassName=N.ClassName+"-filter-row",N.GroupRowClassName=N.ClassName+"-group-row",N.FooterRowClassName=N.ClassName+"-footer-row",N.GroupFooterRowClassName=N.ClassName+"-group-footer-row",N.PagerRowClassName=N.ClassName+"-pager-row",N.EmptyRowClassName=N.ClassName+"-empty-row",N.HeaderElementClassName=N.ClassName+"-header",N.HeaderContentClassName=N.ClassName+"-header-content",N.AllowDragClassName=N.ClassName+"-action",N.DraggableHeaderClassName=N.ClassName+"-draggable-header",N.SelectionCellClassName=N.ClassName+"-selection-cell",N.CommandCellClassName=N.ClassName+"-command-cell",N.FixedCellClassName=N.ClassName+"-fixed-cell",N.LastLeftFixedCellClassName=N.ClassName+"-last-fixed-left-cell",N.IndentCellClassName=N.ClassName+"-indent-cell",N.HeaderIndentCellClassName=N.ClassName+"-header-indent-cell",N.GroupFooterIndentCellClassName=N.ClassName+"-group-footer-indent-cell",N.ExpandButtonCellClassName=N.ClassName+"-expand-button-cell",N.DetailCellClassName=N.ClassName+"-detail-cell",N.EmptyDataRowCellClassName=N.ClassName+"-empty-data",N.EmptyCellClassName=N.ClassName+"-empty-cell",N.EditFormClassName=N.ClassName+"-edit-form",N.SelectedRowClassName=N.ClassName+"-selected-row",N.TouchSelectionClassName=N.ClassName+"-touch-selection",N.TouchSelectionEdgeClassName=N.ClassName+"-touch-selection-edge",N.MoveCursorCssClassName=N.ClassName+"-move-cursor",N.DraggingDownTargetClassName=N.ClassName+"-dragging-down-target",N.DraggingUpTargetClassName=N.ClassName+"-dragging-up-target",N.ColumnsResizeAnchorClassName=N.ClassName+"-column-resize-anchor",N.ColumnsSeparatorClassName=N.ClassName+"-columns-separator",N.HiddenEmptyCellClassName=N.ClassName+"-hidden-empty-cell",N.ColumnChooserItemClassName=N.ClassName+"-column-chooser-item",N.ColumnChooserDraggingItemClassName=N.ClassName+"-column-chooser-dragging-item",N.ColumnChooserDraggingItemNextSiblingClassName=N.ClassName+"-column-chooser-dragging-item-next-sibling",N.ColumnChooserItemDragAnchorClassName=N.ClassName+"-column-chooser-item-drag-anchor",N.HighlightedTextClassName=N.ClassName+"-highlighted-text";class D{}D.VisibleIndexName="data-visible-index",D.SummaryItem=N.ClassName+"-summary-item";class P{}P.TableCell="."+N.DataTableClassName+" > tbody > tr > td",P.TableHeader="."+N.DataTableClassName+" > thead > tr > th",P.TableHeaderCell=`${P.TableHeader} > ${N.HeaderContentClassName}`,P.TableHeaderCellContent=P.TableHeaderCell+" span",P.TableGroupFooterCell=`.${N.DataTableClassName} > tbody > tr.${N.GroupFooterRowClassName} > td`,P.TableGroupFooterCellContent=`${P.TableGroupFooterCell} > div[${D.SummaryItem}]`,P.TableFooterCell="."+N.DataTableClassName+" > tfoot > tr > td",P.TableFooterCellContent=`${P.TableFooterCell} > div[${D.SummaryItem}]`,P.TableCellSelector="."+N.DataTableClassName+" > * > tr > td",P.TitleElementsSelector=[P.TableCellSelector,P.TableHeaderCellContent,P.TableHeader,P.TableFooterCellContent,P.TableGroupFooterCellContent,P.TableFooterCell].join(", "),P.ColElementSelector=`:scope > .${n.ClassName} > .${n.ContentContainerClassName} > .${N.DataTableClassName} > colgroup > col`;const H="dxbl-grid-header-content";class W{get uID(){return this._uID}get allowGroup(){return this._allowGroup}get width(){return this._width}get minWidth(){return this._minWidth}get hasWidth(){return!!this._width}get isFreeWidth(){return!this.width&&!this.isIndent&&!this.isEmpty}get isPercentWidth(){return this.hasWidth&&-1!==this.width.indexOf("%")}get isAbsoluteWidth(){return this.hasWidth&&!this.isPercentWidth||this.isIndent}get colElementWidth(){return this._colElementWidth}set colElementWidth(e){this._colElementWidth=e}get isIndent(){return this._isIndent}get isEmpty(){return this._isEmpty}get isDetail(){return this._isDetail}get fixedPosition(){return this._fixedPosition}constructor(e,t,n,s,i,o=!1,r=!1,l=!1){this._uID=e,this._allowGroup=t,this._width=n,this._colElementWidth=n,this._minWidth=s,this._isIndent=o,this._isEmpty=r,this._isDetail=l,this._fixedPosition=i}getPercents(){return this.isPercentWidth?parseFloat(this.width.replace("%","")):0}updateWidth(e){this._width=e,this._colElementWidth=e}}var T,F;!function(e){e[e.Mouse=1]="Mouse",e[e.Keyboard=2]="Keyboard"}(T||(T={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(F||(F={}));class A{get isResizing(){return!!this.resizeReason}get columnIndex(){return this._columnIndex}get columnsInfo(){return this.grid.columnsInfo}get tableContainerWidth(){return this._tableContainerWidth}get currentColumnInfo(){return this.columnsInfo[this.columnIndex]}constructor(e){this.startMousePosition=-1,this.startHeaderCellPosition=-1,this.timeoutId=null,this.initialColumnWidths=new Map,this.boundOnDocumentPointerMoveHandler=this.onPointerMove.bind(this),this.getColumnOffsetWidth=e=>this.grid.getColElementOffsetWidth(e),this.setColumnWidth=(e,t)=>{this.grid.getColElements()[e].style.width=t},this.grid=e,this.columnResizeSeparator=e.getColumnResizeSeparator()}startDrag(e,n){var s;this.initializeResizing(e),this.resizeReason=T.Mouse,this.startMousePosition=n,this.startHeaderCellPosition=this.getHeaderCellPosition(e),document.addEventListener("pointermove",this.boundOnDocumentPointerMoveHandler),document.body.classList.add(t.ResizeCursor),null===(s=this.grid.getScrollViewer())||void 0===s||s.startAutoScrolling(m.Horizontal,this.boundOnDocumentPointerMoveHandler)}anchorFocused(e){this.resizeReason=T.Keyboard,this.initializeResizing(e)}anchorUnfocused(){this.finalizeResizing(!1)}stopDrag(){this.finalizeResizing(!1)}cancelDrag(){this.timeoutId&&clearTimeout(this.timeoutId),this.finalizeResizing(!0)}performMoveStep(e){if(this.resizeReason===T.Mouse)return;let t=e===F.Right?1:-1;this.isReverseResizing&&(t*=-1);const n=this.calculateDiffByMoveStep(t);this.performResize(n),this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>this.createNotificationAction()()),500)}initializeResizing(e){this.columnResizeSeparator=this.grid.getColumnResizeSeparator(),this._columnIndex=e,this._tableContainerWidth=this.grid.getTableContainerWidth(),this.initialColumnWidths.clear();const t=this.grid.getColElements();for(let e=0;e<t.length;++e)this.initialColumnWidths.set(e,t[e].style.width);this.initializeResizingCore();const n=this.getHeaderCell(e);this.columnResizeSeparator.show(n,this.isReverseResizing),this.grid.updateEmptyColumnVisibility()}performResize(e){var t;e=Math.round(e),this.performResizeCore(e),requestAnimationFrame((()=>this.grid.styleGenerator.updateFixedCellsStyle())),null===(t=this.columnResizeSeparator)||void 0===t||t.render()}finalizeResizing(e){var n,s;if(!this.resizeReason)return;this.resizeReason===T.Mouse&&(document.removeEventListener("pointermove",this.boundOnDocumentPointerMoveHandler),document.body.classList.remove(t.ResizeCursor),null===(n=this.grid.getScrollViewer())||void 0===n||n.stopAutoScrolling(),this.startMousePosition=-1,this.startHeaderCellPosition=-1),null===(s=this.columnResizeSeparator)||void 0===s||s.hide();let i=null;if(e){this.cancelResizeCore();const e=this.grid.getColElements();this.initialColumnWidths.forEach(((t,n)=>{t!==e[n].style.width&&(e[n].style.width=t)})),this.initialColumnWidths.clear(),requestAnimationFrame((()=>this.grid.styleGenerator.updateFixedCellsStyle()))}else i=this.createNotificationAction(),this.finalizeResizeCore();this.grid.updateEmptyColumnVisibility(),this.resizeReason=void 0,this._columnIndex=void 0,this._tableContainerWidth=void 0,this.timeoutId&&clearTimeout(this.timeoutId),i&&i()}createNotificationAction(){const e=this.applyResizingAndGetChangedColumns(),t=e.map((e=>e.uID)),n=e.map((e=>e.width));return()=>{this.grid.onColumnWidthsChanged(t,n)}}getHeaderCellPosition(e){return this.getHeaderCell(e).getBoundingClientRect().x}getHeaderCell(e){return this.grid.getHeaderRow().cells.item(e)}onPointerMove(e){const t=this.getHeaderCellPosition(this.columnIndex);let n=e.pageX-this.startMousePosition;if(this.isReverseResizing)n*=-1;else{n+=this.startHeaderCellPosition-t}this.performResize(n)}}class M extends A{constructor(){super(...arguments),this.columnInitialWidth=-1,this.columnNewWidth=-1,this.nextColumnInitialWidth=-1,this.nextColumnNewWidth=-1,this.nextColumnIndex=-1,this.totalPercents=0,this.totalFreeWidth=0}get nextColumnInfo(){return this.columnsInfo[this.nextColumnIndex]}get isReverseResizing(){return!1}calculateDiffByMoveStep(e){return this.columnNewWidth-this.columnInitialWidth+Math.min(5,Math.ceil((this.columnInitialWidth+this.nextColumnInitialWidth)/100))*e}initializeResizingCore(){this.columnInitialWidth=this.getColumnOffsetWidth(this.columnIndex),this.columnNewWidth=this.columnInitialWidth,this.nextColumnIndex=this.columnIndex+1,this.nextColumnInitialWidth=this.getColumnOffsetWidth(this.nextColumnIndex),this.nextColumnNewWidth=this.nextColumnInitialWidth;for(let e=0;e<this.columnsInfo.length;++e){const t=this.columnsInfo[e];t.isPercentWidth&&(this.totalPercents+=t.getPercents()),t.isFreeWidth&&(this.totalFreeWidth+=this.getColumnOffsetWidth(e))}}performResizeCore(e){this.columnNewWidth=this.columnInitialWidth+e,this.columnNewWidth<this.currentColumnInfo.minWidth&&(this.columnNewWidth=this.currentColumnInfo.minWidth),this.nextColumnNewWidth=this.columnInitialWidth+this.nextColumnInitialWidth-this.columnNewWidth;const t=this.columnInitialWidth+this.nextColumnInitialWidth-this.nextColumnInfo.minWidth;this.columnNewWidth>t&&(this.columnNewWidth=t,this.nextColumnNewWidth=this.nextColumnInfo.minWidth),requestAnimationFrame((()=>{this.setColumnWidth(this.columnIndex,`${this.columnNewWidth}px`),this.setColumnWidth(this.nextColumnIndex,`${this.nextColumnNewWidth}px`)}))}cancelResizeCore(){this.reset()}applyResizingAndGetChangedColumns(){const e=[];if(this.currentColumnInfo.isPercentWidth||this.nextColumnInfo.isPercentWidth)return this.currentColumnInfo.isPercentWidth?this.calculateNewWidthsForPercentColumn(this.currentColumnInfo,this.columnNewWidth,this.columnInitialWidth,this.nextColumnInfo,this.nextColumnNewWidth,this.nextColumnInitialWidth):this.calculateNewWidthsForPercentColumn(this.nextColumnInfo,this.nextColumnNewWidth,this.nextColumnInitialWidth,this.currentColumnInfo,this.columnNewWidth,this.columnInitialWidth);{const t=0!==this.totalPercents,n=(this.currentColumnInfo.isFreeWidth||this.nextColumnInfo.isFreeWidth)&&!t;if((this.currentColumnInfo.isAbsoluteWidth||this.currentColumnInfo.isFreeWidth&&t)&&(this.currentColumnInfo.updateWidth(`${this.columnNewWidth}px`),e.push(this.currentColumnInfo)),n){const t=this.totalFreeWidth+(this.currentColumnInfo.isFreeWidth?this.columnNewWidth-this.columnInitialWidth:0)+(this.nextColumnInfo.isFreeWidth?this.nextColumnNewWidth-this.nextColumnInitialWidth:0);for(let n=0;n<this.columnsInfo.length;++n){const s=this.columnsInfo[n];s.isFreeWidth&&(s.updateWidth(100*this.getColumnOffsetWidth(n)/t+"%"),e.push(s))}}}return e.includes(this.nextColumnInfo)||(this.nextColumnInfo.updateWidth(`${this.nextColumnNewWidth}px`),e.push(this.nextColumnInfo)),e}calculateNewWidthsForPercentColumn(e,t,n,s,i,o){const r=[],l=(e,t,n)=>e*t/n,a=e.getPercents(),d=l(a,t,n);if(e.updateWidth(e.colElementWidth===e.width?`${d}%`:`${t}px`),r.push(e),s.isPercentWidth)s.updateWidth(`${l(s.getPercents(),i,o)}%`),r.push(s);else{s.updateWidth(`${i}px`),r.push(s);const t=this.totalPercents-a+d;if(t>100){const n=t/this.totalPercents;for(let t=0;t<this.columnsInfo.length;++t){const s=this.columnsInfo[t];s.isPercentWidth&&(s.updateWidth(s.getPercents()/n+"%"),s!==e&&r.push(s))}}}return r}finalizeResizeCore(){this.reset()}reset(){this.columnInitialWidth=-1,this.columnNewWidth=-1,this.nextColumnInitialWidth=-1,this.nextColumnNewWidth=-1,this.nextColumnIndex=-1,this.totalFreeWidth=0,this.totalPercents=0}}class _ extends A{constructor(){super(...arguments),this.enforcedColumnWidths=new Map,this.columnInitialWidth=-1,this.columnNewWidth=-1}get isReverseResizing(){return"right"===this.currentColumnInfo.fixedPosition}calculateDiffByMoveStep(e){return this.columnNewWidth-this.columnInitialWidth+Math.min(5,Math.ceil(2*this.columnInitialWidth/100))*e}initializeResizingCore(){if(this.columnInitialWidth=this.getColumnOffsetWidth(this.columnIndex),this.columnNewWidth=this.columnInitialWidth,this.currentColumnInfo.fixedPosition){let e=this.tableContainerWidth;for(let t=0;t<this.columnsInfo.length;++t){const n=this.columnsInfo[t];n!==this.currentColumnInfo&&n.fixedPosition&&(e-=this.getColumnOffsetWidth(t))}this.columnMaxWidth=Math.max(this.columnInitialWidth,e)}this.enforcedColumnWidths.clear();for(let e=0;e<this.columnsInfo.length;++e){const t=this.columnsInfo[e];if(!t.isIndent&&!t.isEmpty&&!t.isAbsoluteWidth){const t=`${this.getColumnOffsetWidth(e)}px`;this.setColumnWidth(e,t),this.enforcedColumnWidths.set(e,t)}}}performResizeCore(e){let t=this.columnInitialWidth+e;t<this.currentColumnInfo.minWidth&&(t=this.currentColumnInfo.minWidth),this.columnMaxWidth&&t>this.columnMaxWidth&&(t=this.columnMaxWidth),this.columnNewWidth=t;const n=this.columnIndex;requestAnimationFrame((()=>this.setColumnWidth(n,`${t}px`)))}cancelResizeCore(){this.reset()}applyResizingAndGetChangedColumns(){const e=[],t=this.columnsInfo,n=t[this.columnIndex];return n.updateWidth(`${this.columnNewWidth}px`),e.push(n),this.enforcedColumnWidths.forEach(((s,i)=>{const o=t[i];o!==n&&(o.updateWidth(s),e.push(o))})),e}finalizeResizeCore(){this.reset()}reset(){this.columnInitialWidth=-1,this.columnNewWidth=-1,this.enforcedColumnWidths.clear(),this.columnMaxWidth=void 0}}class B extends e{constructor(){super(),this.cell=null,this.leftSide=!1,this.parentWidth=0,this.tableContainerResizeObserver=new ResizeObserver(this.onTableContainerSizeChanged.bind(this)),this.boundOnTableContainerScroll=this.onTableContainerScroll.bind(this)}get tableContainer(){return this._tableContainer}initializeComponent(){super.initializeComponent(),this.initializeTableContainer(),this.tableContainer.addEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.observe(this.tableContainer)}initializeTableContainer(){this._tableContainer=this.closest(`.${n.ContentContainerClassName}`)}disposeComponent(){super.disposeComponent(),this.tableContainer.removeEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.unobserve(this.tableContainer)}show(e,t){this.cell=e,this.leftSide=t,this.classList.add(B.ActiveColumnResizeSeparator),this.render()}hide(){this.cell=null,this.leftSide=!1,this.classList.remove(B.ActiveColumnResizeSeparator),this.style.transform="none"}render(){requestAnimationFrame((()=>{if(!this.cell)return;const e=this.getColumnSeparatorPosition(this.cell),t=this.getBorderWidth(this.cell),n=B.getCenteredByBorderPosition(e,this.offsetWidth,t),s=this.getActualHeight();this.style.transform=`translateX(${n})`,s>0&&(this.style.height=`${s}px`)}))}onTableContainerScroll(){this.render()}onTableContainerSizeChanged(e){const t=e[0].contentRect.width;this.parentWidth!==t&&(this.parentWidth=t,this.render())}getColumnSeparatorPosition(e){const t=e.offsetLeft-this.tableContainer.scrollLeft;return this.leftSide?t:t+e.offsetWidth}getActualHeight(){const e=this.tableContainer.querySelector(`.${N.DataTableClassName} > tfoot`);if(!e)return 0;const t=e.getBoundingClientRect().height;return this.tableContainer.getBoundingClientRect().height-t}getBorderWidth(e){var t;const n=B.getBorderWidthByElement(e,"border-right-width");if(n>0)return n;const s=null===(t=this.cell)||void 0===t?void 0:t.nextElementSibling;return s&&B.getBorderWidthByElement(s,"border-left-width")}static getBorderWidthByElement(e,t){const n=getComputedStyle(e),s=n.getPropertyValue(t);return parseFloat(s)||parseFloat(n.borderWidth)}static getCenteredByBorderPosition(e,t,n){return e-(t-n)/2+"px"}}var O;B.ActiveColumnResizeSeparator=t.Active,function(e){e[e.ItemMoving=0]="ItemMoving",e[e.Stop=1]="Stop",e[e.Cancel=2]="Cancel"}(O||(O={}));class L{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.reorderContext=null,this.reorderingCallback=e}start(e,t,n){const s=e.map((e=>e.getBoundingClientRect())),i=e.map((e=>e.getAttribute("data-column-fixed-position"))),o=e.indexOf(t),r=t.parentElement,l=L.calculateReorderIntervals(s,o,i),a=L.findInterval(l,0);this.reorderContext={state:O.ItemMoving,startY:n.y,currentY:n.y,offsetParentStartY:L.calcOffsetParentY(r),offsetParent:r,draggingItemIndex:o,draggingItem:t,items:e,intervals:l,initialInterval:a,currentInterval:a},this.refreshUI(),document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler)}stop(){this.end(O.Stop)}cancel(){this.end(O.Cancel)}end(e){null!=this.reorderContext&&(this.reorderContext.state=e,this.refreshUI(),document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler))}onDocumentMouseMove(e){null!=this.reorderContext&&(this.reorderContext.currentY=e.y,this.refreshUI())}refreshUI(){if(null==this.reorderContext)return;const e=this.reorderContext.offsetParentStartY-L.calcOffsetParentY(this.reorderContext.offsetParent),t=this.reorderContext.currentY-this.reorderContext.startY+e;let n=L.findInterval(this.reorderContext.intervals,t);this.reorderContext.state===O.Cancel&&(n=this.reorderContext.initialInterval),this.reorderContext.currentInterval=n,this.applyTransformations(t)}applyTransformations(e){requestAnimationFrame((()=>{if(null==this.reorderContext)return;const t=this.reorderContext.currentInterval;if(null==t)return;const n=this.reorderContext.state===O.ItemMoving&&e>=t.top&&e<=t.bottom;for(let s=0;s<t.transforms.length;s++){let i=t.transforms[s];s===this.reorderContext.draggingItemIndex&&n&&(i=e),this.reorderContext.items[s].style.transform="translate(0, "+i+"px)"}this.reorderingCallback(this.reorderContext.items,t.itemIndices,this.reorderContext.draggingItemIndex,this.reorderContext.state)}))}static calcOffsetParentY(e){return e.getBoundingClientRect().y-e.scrollTop}static calculateReorderIntervals(e,t,n){const s=L.calcIntervalBounds(e,t,n),i=Array.from(Array(e.length).keys());i.splice(t,1);const o=e[t].height,r=[];for(let e=0;e<s.length;e++){const n=s[e],l=Array.from(i);l.splice(n.itemIndex,0,t),r.push({top:n.top,bottom:n.bottom,itemIndices:l,transforms:this.calcItemsTransformations(l,o),itemIndex:n.itemIndex})}return r}static calcIntervalBounds(e,t,n){const s=Array.from(Array(e.length).keys()),i=n[t];let o=0!==t?s.slice(0,t).reverse():[],r=t!==s.length-1?s.slice(t+1):[];n.filter((e=>null!==e)).length>0&&(o=o.filter((e=>n[e]===i)),r=r.filter((e=>n[e]===i)));const l=this.calcIntervalBoundsCore(e,o),a=this.calcIntervalBoundsCore(e,r),d=[];l.reverse();for(let e=0;e<l.length;e++){const t=l[e];d.push({top:-1*t.bottom,bottom:-1*t.top,itemIndex:t.itemIndex})}return d.push({top:d.length>0?d[d.length-1].bottom+1:0,bottom:a.length>0?a[0].top-1:0,itemIndex:t}),d.concat(a)}static calcIntervalBoundsCore(e,t){if(0===t.length)return[];let n=0;const s=[];for(let i=0;i<t.length;i++){const o=e[t[i]].height;s.push(n+Math.ceil(o/2)),n+=o}s.push(n);const i=[];for(let e=0;e<s.length-1;e++)i.push({top:1+s[e],bottom:s[e+1],itemIndex:t[e]});return i}static calcItemsTransformations(e,t){const n=[];for(let s=0;s<e.length;s++){let i=0;const o=e.indexOf(s)-s;0!==o&&(i=t*o),n.push(i)}return n}static findInterval(e,t){for(let n=0;n<e.length;n++)if(t>=e[n].top&&t<=e[n].bottom)return e[n];return t<e[0].top?e[0]:t>e[e.length-1].bottom?e[e.length-1]:null}}const z="data-column-uid";var K,$,k,G;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(K||(K={}));class U{constructor(){this.downTargetElement=U.addTargetToDom(N.DraggingDownTargetClassName,p.ArrowDownIconName),this.upTargetElement=U.addTargetToDom(N.DraggingUpTargetClassName,p.ArrowUpIconName);const e=this.upTargetElement.getBoundingClientRect();this.targetElementSize={width:e.width,height:e.height},this.upTargetElementPosition=null,this.downTargetElementPosition=null,this.hide()}show(){this.upTargetElementPosition&&this.downTargetElementPosition&&(this.downTargetElement.style.transform=v.translateByPoint(this.downTargetElementPosition),this.upTargetElement.style.transform=v.translateByPoint(this.upTargetElementPosition),this.downTargetElement.classList.remove(t.DisplayNone),this.upTargetElement.classList.remove(t.DisplayNone))}hide(){this.downTargetElement.classList.add(t.DisplayNone),this.upTargetElement.classList.add(t.DisplayNone)}setPositionRelativeToElement(e,t){this.setUpTargetPosition(e,t),this.setDownTargetPosition(e,t)}setUpTargetPosition(e,t){this.upTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y+e.height}}setDownTargetPosition(e,t){this.downTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y-this.targetElementSize.height}}getTargetXCoordinate(e,t){let n=e.x-this.targetElementSize.width/2;return t===K.Right&&(n+=e.width),n}dispose(){U.removeElementsByClassName(N.DraggingDownTargetClassName),U.removeElementsByClassName(N.DraggingUpTargetClassName)}static removeElementsByClassName(e){const t=document.querySelectorAll(`.${e}`);for(let e=0;e<t.length;e++)t[e].remove()}static addTargetToDom(e,t){const n=document.createElement("div");return n.className=e,n.innerHTML=p.getSvgHtml(t),document.body.appendChild(n),n}}!function(e){e[e.Header=0]="Header",e[e.GroupPanel=1]="GroupPanel",e[e.ColumnChooser=2]="ColumnChooser"}($||($={}));class V{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.boundOnDocumentScrollHandler=this.onDocumentScroll.bind(this),this.boundOnHeaderMouseMoveHandler=this.onHeaderMouseMove.bind(this),this.boundOnElementMouseOutHandler=this.onElementMouseOut.bind(this),this.boundOnGroupPanelMouseMoveHandler=this.onGroupPanelMouseMove.bind(this),this.boundOnEmptyHeaderCellMouseMoveHandler=this.onEmptyHeaderCellMouseMove.bind(this),this.boundOnGroupFreeSpaceMouseMoveHandler=this.onGroupFreeSpaceMouseMove.bind(this),this.draggableContext=null,this.isRefreshUIRequested=!1,this.grid=e}start(e,t){const n=V.addDraggableHeaderToDOM(e);this.draggableContext=this.createDraggableContext(e,n,t),this.addEventSubscriptions(),this.updateDraggableElement(t),this.grid.styleGenerator.notifyColumnDragStarted()}stop(){var e;this.isRefreshUIRequested=!1,null===(e=this.draggableContext)||void 0===e||e.targets.dispose(),this.draggableContext=null,V.removeDraggableHeaderFromDom(),this.removeEventSubscriptions(),document.body.classList.remove(N.MoveCursorCssClassName),this.grid.styleGenerator.notifyColumnDragEnded()}isStarted(){return!!this.draggableContext}updateDraggableContextByEvent(e){const t=document.elementFromPoint(e.clientX,e.clientY);this.updateDraggableContextByElement(t,e)}onDocumentMouseMove(e){this.updateDraggableElement(e)}onDocumentScroll(e){this.draggableContext&&(this.draggableContext.currentScrollPosition=V.getDocumentScrollPosition(),this.draggableContext.srcHeaderPosition=V.getElementPosition(this.draggableContext.srcHeaderElement),this.draggableContext.mouseOverElement&&this.setMouseOverElementInfo(this.draggableContext.mouseOverElement),this.updateDraggableElementPosition(),this.refreshUI())}onHeaderMouseMove(e){this.updateDraggableContextByElement(e.target,e)}onElementMouseOut(e){this.clearMoveStateFromDraggableContext(),this.refreshUI()}onGroupPanelMouseMove(){const e=this.grid.getGroupPanelContentContainer();this.onPanelElementMouseMove(e,$.GroupPanel)}onEmptyHeaderCellMouseMove(){const e=this.grid.getEmptyHeaderCellContentContainer();this.onPanelElementMouseMove(e,$.Header)}onGroupFreeSpaceMouseMove(){const e=this.grid.getGroupContentFreeSpaceElement();this.onPanelElementMouseMove(e,$.GroupPanel)}updateDraggableElement(e){this.draggableContext&&(this.draggableContext.currentCursorPosition={x:e.pageX,y:e.pageY},this.draggableContext.initialScrollPosition=this.draggableContext.currentScrollPosition,this.updateDraggableElementPosition(),this.refreshUI())}onPanelElementMouseMove(e,t){e&&this.draggableContext&&this.draggableContext.mouseOverElement!==e&&this.draggableContext.srcHeaderElement!==e.previousElementSibling&&(this.clearMoveStateFromDraggableContext(),this.setMouseOverElementInfo(e),this.draggableContext.dropArea=t,this.isPossibleDropToCurrentArea()&&(this.draggableContext.isPossibleDropColumn=!0,this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,K.Left)),this.refreshUI())}isPossibleDropToCurrentArea(){var e,t,n;return(null===(e=this.draggableContext)||void 0===e?void 0:e.allowGroup)||(null===(t=this.draggableContext)||void 0===t?void 0:t.dropArea)===(null===(n=this.draggableContext)||void 0===n?void 0:n.srcArea)}createColumnDraggedHandlerArgs(){if(!this.draggableContext||!this.draggableContext.isPossibleDropColumn)return null;const e=this.draggableContext;return{columnUid:e.draggedColumn.uID,beforeColumnUid:e.beforeColumnUid,dropArea:e.dropArea}}updateDraggableContextByElement(e,t){const n=this.grid.findHeaderElement(e);n&&(this.updateDraggableContext(n,t),this.refreshUI())}updateDraggableContext(e,t){var n,s;if(this.clearMoveStateFromDraggableContext(),null!=this.draggableContext&&this.draggableContext.srcHeaderElement!==e&&(this.setMouseOverElementInfo(e),this.isPossibleDropToCurrentArea())){const i=this.isThereCursorInLeftPart(t);if(i&&e.previousElementSibling!==this.draggableContext.srcHeaderElement){const t=this.grid.getColumnInfo(e),s=this.grid.getColumnInfo(e.previousElementSibling);if(!this.canDropBetweenColumns(s,t))return void(this.draggableContext.isPossibleDropColumn=!1);this.draggableContext.beforeColumnUid=null!==(n=null==t?void 0:t.uID)&&void 0!==n?n:-1,this.draggableContext.isPossibleDropColumn=!0}if(!i&&e.nextElementSibling!==this.draggableContext.srcHeaderElement){const t=this.grid.getColumnInfo(e.nextElementSibling),n=this.grid.getColumnInfo(e);if(!this.canDropBetweenColumns(n,t))return void(this.draggableContext.isPossibleDropColumn=!1);this.draggableContext.beforeColumnUid=null!==(s=null==t?void 0:t.uID)&&void 0!==s?s:-1,this.draggableContext.isPossibleDropColumn=!0}this.draggableContext.isPossibleDropColumn&&this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,i?K.Left:K.Right)}}canDropBetweenColumns(e,t){if(!this.draggableContext)return!1;if(this.draggableContext.dropArea===$.GroupPanel)return!0;const n=e=>"left"===e?0:"right"===e?2:1,s=[];e&&s.push(n(e.fixedPosition)),s.push(n(this.draggableContext.draggedColumn.fixedPosition)),t&&s.push(n(t.fixedPosition));for(let e=0;e<s.length-1;++e)if(s[e]>s[e+1])return!1;return!0}getDropColumnArea(e){const t=this.grid.getGroupPanelContentContainer();return t&&V.isThereHeaderInsideGroupPanel(t,e)?$.GroupPanel:$.Header}static isThereHeaderInsideGroupPanel(e,t){const n=e.childNodes.length;for(let s=0;s<n;s++)if(e.childNodes[s]===t)return!0;return!1}refreshUI(){this.isRefreshUIRequested||(this.isRefreshUIRequested=!0,requestAnimationFrame((()=>{this.isRefreshUIRequested=!1;const e=this.draggableContext;e&&(e.headerElement.style.transform=`translate(${Math.round(e.draggableElementPosition.x)}px, ${Math.round(e.draggableElementPosition.y)}px)`,e.headerElement.classList.add("visible"),e.isPossibleDropColumn?e.targets.show():e.targets.hide(),document.body.classList.add(N.MoveCursorCssClassName))})))}setMouseOverElementInfo(e){if(!this.draggableContext)return;this.draggableContext.mouseOverElement=e;const t=e.getBoundingClientRect();if(this.draggableContext.mouseOverElementRect={x:t.left+this.draggableContext.currentScrollPosition.x,y:t.top+this.draggableContext.currentScrollPosition.y,width:t.width,height:t.height},this.draggableContext.scrollViewerRect){const e=this.draggableContext.scrollViewerRect;this.draggableContext.mouseOverElementRect.x<e.x&&(this.draggableContext.mouseOverElementRect.x=e.x),this.draggableContext.mouseOverElementRect.x+this.draggableContext.mouseOverElementRect.width>e.x+e.width&&(this.draggableContext.mouseOverElementRect.width=e.x+e.width-this.draggableContext.mouseOverElementRect.x)}this.draggableContext.dropArea=this.getDropColumnArea(e)}isThereCursorInLeftPart(e){if(!this.draggableContext||!this.draggableContext.mouseOverElementRect)return!1;const t=this.draggableContext.mouseOverElementRect;return e.pageX<t.x+t.width/2}updateDraggableElementPosition(){if(!this.draggableContext)return;const e=this.draggableContext;e.draggableElementPosition={x:e.srcHeaderPosition.x+(e.currentCursorPosition.x-e.initialCursorPosition.x)+(e.currentScrollPosition.x-e.initialScrollPosition.x)+e.currentScrollPosition.x,y:e.srcHeaderPosition.y+(e.currentCursorPosition.y-e.initialCursorPosition.y)+(e.currentScrollPosition.y-e.initialScrollPosition.y)+e.currentScrollPosition.y}}addEventSubscriptions(){document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.addEventListener("scroll",this.boundOnDocumentScrollHandler),this.addHeaderEventSubscriptions(),this.addGroupPanelEventSubscriptions(),this.addEmptyHeaderCellEventSubscriptions(),this.addGroupContentFreeSpaceElementEventSubscriptions()}addHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.addEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}}addEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.addPanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}addGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.addPanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}addGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.addPanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}addPanelElementEventSubscriptions(e,t){e.addEventListener("pointermove",t),e.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}removeEventSubscriptions(){document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.removeEventListener("scroll",this.boundOnDocumentScrollHandler),this.removeHeaderEventSubscriptions(),this.removeGroupPanelEventSubscriptions(),this.removeEmptyHeaderCellEventSubscriptions(),this.removeGroupContentFreeSpaceElementEventSubscriptions()}removeHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}}removeGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.removePanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}removeEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.removePanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}removeGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.removePanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}removePanelElementEventSubscriptions(e,t){e.removeEventListener("pointermove",t),e.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}shouldAddEventListenersToGroupPanel(){const e=this.grid.getGroupPanelContentContainer();return!!e&&!(null==e?void 0:e.querySelector(`.${N.HeaderElementClassName}`))}static addDraggableHeaderToDOM(e){const t=document.createElement("div");t.className=`${N.DraggableHeaderClassName}`,e.classList.contains(N.SelectionCellClassName)&&t.classList.add(N.SelectionCellClassName),e.classList.contains(N.CommandCellClassName)&&t.classList.add(N.CommandCellClassName);const n=e.getBoundingClientRect();t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const s=getComputedStyle(e);t.style.padding=s.padding,t.style.font=s.font;const i=this.getContentElement(e).cloneNode(!0);return t.appendChild(i),document.body.appendChild(t),t}static getContentElement(e){return e.querySelector(`.${N.HeaderContentClassName}`)}static removeDraggableHeaderFromDom(){const e=document.querySelectorAll(`.${N.DraggableHeaderClassName}`);for(let t=0;t<e.length;t++)e[t].remove()}createDraggableContext(e,t,n){const s=V.getDocumentScrollPosition(),i=V.getPointerPosition(n),o=this.grid.getScrollViewer(),r=this.grid.getColumnInfo(e);return{srcHeaderPosition:V.getElementPosition(e),srcHeaderElement:e,headerElement:t,allowGroup:r.allowGroup,mouseOverElement:null,mouseOverElementRect:null,scrollViewerRect:o&&o.getRectangle(),isPossibleDropColumn:!1,draggedColumn:r,beforeColumnUid:null,srcArea:e.closest(`.${N.GroupPanelContentContainerClassName}`)?$.GroupPanel:$.Header,dropArea:$.Header,initialCursorPosition:i,currentCursorPosition:{x:0,y:0},draggableElementPosition:i,initialScrollPosition:s,currentScrollPosition:s,targets:new U}}clearMoveStateFromDraggableContext(){this.draggableContext&&(this.draggableContext.mouseOverElement=null,this.draggableContext.mouseOverElementRect=null,this.draggableContext.isPossibleDropColumn=!1,this.draggableContext.beforeColumnUid=null)}static getPointerPosition(e){return{x:e.pageX,y:e.pageY}}static getDocumentScrollPosition(){return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}static getElementPosition(e){const{left:t,top:n}=e.getBoundingClientRect();return{x:t,y:n}}}class q{constructor(e){this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1,this.savedSelectedRows=[],this.boundOnRowPointerEnterHandler=this.onRowPointerEnter.bind(this),this.grid=e}get startSelectionRowIndex(){return this._startSelectionRowIndex}get endSelectionRowIndex(){return this._endSelectionRowIndex}start(e,t){this._startSelectionRowIndex=this.grid.getRowVisibleIndexByTarget(e),this._startSelectionRowIndex>-1&&(this._endSelectionRowIndex=this._startSelectionRowIndex,t&&this.storeSelectedRows(),this.addRowEventSubscriptions(),this.updateRowsSelection())}stop(){this._startSelectionRowIndex>-1&&(this.deselectRows(),this.removeRowEventSubscriptions(),this.restoreSelectedRows(),this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1)}isStarted(){return this._startSelectionRowIndex>-1&&this._endSelectionRowIndex>-1}updateSeletionByEvent(e){const t=document.elementFromPoint(e.clientX,e.clientY);this.updateSeletionByElement(t)}findRowElement(e){return this.grid.getMainElement().querySelector(`tr[${D.VisibleIndexName}="${e}"]`)}findRowElements(){return this.grid.getMainElement().querySelectorAll(`tr[${D.VisibleIndexName}]`)}findSelectedRowElements(){return this.grid.getMainElement().querySelectorAll(`tr.${N.SelectedRowClassName}[${D.VisibleIndexName}]`)}addRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}removeRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].removeEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}updateSeletionByElement(e){const t=this.grid.getRowVisibleIndexByTarget(e,!0);t>-1&&(this._endSelectionRowIndex=t,this.updateRowsSelection())}onRowPointerEnter(e){this.updateSeletionByElement(e.target)}selectRows(e){for(let t=0;t<e.length;t++){const n=this.findRowElement(e[t]);n&&n.classList.add(0===t||t===e.length-1?N.TouchSelectionEdgeClassName:N.TouchSelectionClassName)}}deselectRows(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(N.TouchSelectionClassName,N.TouchSelectionEdgeClassName)}updateRowsSelection(){if(-1===this.startSelectionRowIndex||-1===this.endSelectionRowIndex)return;this.deselectRows();const e=Math.min(this.startSelectionRowIndex,this.endSelectionRowIndex),t=Math.max(this.startSelectionRowIndex,this.endSelectionRowIndex),n=Array.from({length:t-e+1},((t,n)=>n+e));this.selectRows(n)}storeSelectedRows(){const e=this.findSelectedRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(N.SelectedRowClassName),this.savedSelectedRows.push(e[t])}restoreSelectedRows(){for(let e=0;e<this.savedSelectedRows.length;e++)this.savedSelectedRows[e].classList.add(N.SelectedRowClassName);this.savedSelectedRows=[]}}!function(e){e[e.ColumnsChanged=0]="ColumnsChanged",e[e.GridResize=1]="GridResize"}(k||(k={}));class j{constructor(e){this.grid=e}correctWidths(e){return 0!==this.grid.columnsInfo.length&&("fixed"===window.getComputedStyle(this.grid.getDataTable()).tableLayout&&(requestAnimationFrame((()=>{const t=this.grid.columnsInfo,n=this.grid.getColElements();if(e===k.ColumnsChanged&&j.resetColumnWidths(t,n),!j.canAcquireAbsoluteColumnWidths(this.grid))return;this.updateEmptyColumnVisibility();const s=new Map;for(let e=0;e<this.grid.columnsInfo.length;++e){const t=this.grid.columnsInfo[e];t.isAbsoluteWidth&&s.set(t,this.grid.getColElementOffsetWidth(e))}const i={columnsInfo:this.grid.columnsInfo,columnCurrentWidths:new Map,tableWidth:this.grid.getTableContainerWidth(),absoluteColumnWidths:s,percentColumns:this.grid.columnsInfo.filter((e=>e.isPercentWidth)),freeColumns:this.grid.columnsInfo.filter((e=>e.isFreeWidth)),emptyColumn:this.grid.columnsInfo.filter((e=>e.isEmpty))[0]};j.doDistributionWaves(i),j.applyColumnWidths(i,n),this.updateEmptyColumnVisibility(),this.grid.styleGenerator.updateFixedCellsStyle(),this.grid.virtualSpacerAppearanceProvider.updatePlaceholders()})),!0))}updateEmptyColumnVisibility(){const e=this.grid.getColElements(),t=e[e.length-1];j.hasAnyDataColumnWithEmptyWidth(this.grid.columnsInfo,e)?t.classList.add(N.HiddenEmptyCellClassName):t.classList.remove(N.HiddenEmptyCellClassName)}static resetColumnWidths(e,t){for(let n=0;n<t.length;n++){const s=e[n];!s||s.isIndent||s.isEmpty||(t[n].style.width=s.width)}}static doDistributionWaves(e){let t=!1,n=0;do{j.performAllColumnsRealWidthCalculation(e),t=j.evaluateColumnMinWidthCorrection(e)}while(t&&++n<=e.columnsInfo.length)}static performAllColumnsRealWidthCalculation(e){e.columnCurrentWidths=new Map;const t=j.calculateAbsoluteColumnWidths(e);let n=Math.max(0,e.tableWidth-t);n=j.calculatePercentColumnWidths(e,n),n=j.calculateFreeColumnWidths(e,n),j.calculateEmptyColumnWidth(e,n)}static calculateAbsoluteColumnWidths(e){let t=0;for(const n of e.absoluteColumnWidths.keys()){const s=e.absoluteColumnWidths.get(n);t+=s,e.columnCurrentWidths.set(n,s)}return t}static calculatePercentColumnWidths(e,t){let n=0;for(const t of e.percentColumns)n+=t.getPercents();let s=e.tableWidth;const i=n>100?100/n:1,o=s*(n*i)/100;s*=t<o?t/o:1;let r=0;for(const t of e.percentColumns){const n=s*(t.getPercents()*i/100);e.columnCurrentWidths.set(t,n),r+=n}return t-r}static calculateFreeColumnWidths(e,t){if(e.freeColumns.length>0){const n=t/e.freeColumns.length;for(const t of e.freeColumns)e.columnCurrentWidths.set(t,n);return 0}return t}static calculateEmptyColumnWidth(e,t){e.emptyColumn&&e.columnCurrentWidths.set(e.emptyColumn,t)}static evaluateColumnMinWidthCorrection(e){const t=e.absoluteColumnWidths.size;for(const t of e.columnCurrentWidths.keys())e.columnCurrentWidths.get(t)>t.minWidth||0===t.minWidth||e.absoluteColumnWidths.set(t,t.minWidth);return e.percentColumns=e.percentColumns.filter((t=>!e.absoluteColumnWidths.has(t))),e.freeColumns=e.freeColumns.filter((t=>!e.absoluteColumnWidths.has(t))),t!==e.absoluteColumnWidths.size}static applyColumnWidths(e,t){for(let n=0;n<e.columnsInfo.length;++n){const s=e.columnsInfo[n];if(s.isIndent)continue;const i=e.absoluteColumnWidths.has(s)?`${e.absoluteColumnWidths.get(s)}px`:s.width;e.columnsInfo[n].colElementWidth=i,t[n].style.width=i}}static hasAnyDataColumnWithEmptyWidth(e,t){let n=0;for(let s=0;s<e.length;s++){const i=e[s];if(!i.isIndent&&!i.isEmpty&&(++n,!t[s].style.width))return!0}return 0===n}static canAcquireAbsoluteColumnWidths(e){for(let t=0;t<e.columnsInfo.length;++t){if(e.columnsInfo[t].isAbsoluteWidth&&null===e.getColElementOffsetWidth(t))return!1}return!0}}!function(e){e[e.Disabled=0]="Disabled",e[e.LeftBorder=1]="LeftBorder",e[e.BetweenBorders=2]="BetweenBorders",e[e.RightBorder=3]="RightBorder"}(G||(G={}));class Y{get highlightLeftBorder(){return this.scrollStatus===G.BetweenBorders||this.scrollStatus===G.RightBorder||this.isDragging}get highlightRightBorder(){return this.scrollStatus===G.BetweenBorders||this.scrollStatus===G.LeftBorder||this.isDragging}constructor(e){this.grid=e,this.gridUid="",this.lastGeneratedStyle="",this.isDragging=!1,this.scrollStatus=G.Disabled}notifyColumnDragStarted(){this.hasAnyFixedColumn()&&(this.isDragging=!0,requestAnimationFrame((()=>this.updateFixedCellsStyle())))}notifyColumnDragEnded(){this.hasAnyFixedColumn()&&(this.isDragging=!1,requestAnimationFrame((()=>this.updateFixedCellsStyle())))}scrollPositionUpdated(e){this.hasAnyFixedColumn()&&(this.scrollStatus=this.calcScrollStatus(e),requestAnimationFrame((()=>this.updateFixedCellsStyle())))}updateFixedCellsStyle(){this.gridUid=this.grid.getAttribute(ze);const e=this.grid.querySelector("style");if(!e)return;let t="";this.hasAnyFixedColumn()&&(t+=this.createPositionStyles(),t+=this.createBorderStyles()),this.lastGeneratedStyle!==t&&(e.innerText=t,this.lastGeneratedStyle=t)}createPositionStyles(){const e=this.grid.getColElements(),t=this.getOffsetWidths(e),n=new Array(t.length),s=new Array(t.length);n[0]=0,s[t.length-1]=0;for(let e=1;e<t.length;++e)n[e]=n[e-1]+t[e-1];for(let e=t.length-2;e>=0;--e)s[e]=s[e+1]+t[e+1];const i=this.grid.columnsInfo.some((e=>"left"===e.fixedPosition));let o="";for(let e=0;e<this.grid.columnsInfo.length;++e){const t=this.grid.columnsInfo[e];let r=t.fixedPosition;if(t.isIndent&&i&&(r="left"),r){o+=this.createPositionStyleForColumn(e,r,"left"===r?n[e]:s[e])}}return o}hasAnyFixedColumn(){return this.grid.columnsInfo.some((e=>!!e.fixedPosition))}calcScrollStatus(e){const t=this.grid.getDataTable().clientWidth;return t===e.clientWidth?G.Disabled:0===e.scrollLeft?G.LeftBorder:Math.abs(t-e.clientWidth-e.scrollLeft)<1?G.RightBorder:G.BetweenBorders}createPositionStyleForColumn(e,t,n){return this.getTableRowsSelector()+` > .${N.FixedCellClassName}:nth-child(${e+1})`+` { ${t}: ${n}px; }`}createBorderStyles(){const e=["td","th"];let t="";if(this.highlightLeftBorder)for(const n of e)t+=this.getTableRowsSelector()+` > ${n}.${N.LastLeftFixedCellClassName} { border-right-color: var(--dxbl-grid-fixed-column-border-color); }`;if(this.highlightRightBorder)for(const n of e)t+=this.getTableRowsSelector()+` > ${n}:not(.${N.FixedCellClassName}) + ${n}.${N.FixedCellClassName} { border-left-color: var(--dxbl-grid-fixed-column-border-color); }`;return t}getTableRowsSelector(){return[`${Le}[${ze}="${this.gridUid}"]`,`.${n.ClassName}`,`.${n.ContentContainerClassName}`,`.${N.DataTableClassName}`,"*","tr"].join(" > ")}getOffsetWidths(e){const t=[];for(let n=0;n<e.length;++n)t.push(this.grid.getColElementOffsetWidth(n));return t}}class X{constructor(e,t){this._nestedContentSelected=!1,this._selectedItemIndex=0,this._navigator=e,this._targetElement=t,this.items=[]}get navigator(){return this._navigator}get targetElement(){return this._targetElement}get nestedContentSelected(){return this._nestedContentSelected}set nestedContentSelected(e){this._nestedContentSelected=e&&this.canFocusSelectedItem()}get selectedItemIndex(){return this._selectedItemIndex}set selectedItemIndex(e){this._selectedItemIndex=e}get selectedItemElement(){return this.items[this.selectedItemIndex]}get itemCount(){return this.items.length}getShortcutContext(){return{}}initialize(){const e=this.selectedItemElement;this.items.splice(0);const t=this.queryItems().filter((e=>!!e));0===t.length&&t.push(this.targetElement);for(const e of t){this.items.push(e);let t=this.navigator.getStrategy(e);t||(t=this.createItemStrategy(e),this.navigator.attachStrategy(t)),t&&t!==this&&t.initialize()}e&&this.tryRestoreSelectedItem(e)}queryItems(){return new Array}queryItemsBySelector(e){return Array.from(this.targetElement.querySelectorAll(e))}createItemStrategy(e){return null}getSelectedItemStrategy(){return this.navigator.getStrategy(this.selectedItemElement)}getItem(e){return this.items[e]}activate(){this.selectItem(this.selectedItemIndex)}updateSelectedItemByChildElement(e){const t=X.findItemElementIndexByChild(this.items,e);this.updateSelectedItemByIndex(t)}focusSelectedItem(){this.canFocusSelectedItem()&&S(this.selectedItemElement)}captureFocus(){this.nestedContentSelected&&this.leaveFromNestedContent()}findLastSelectedStrategy(){const e=this.getSelectedItemStrategy();return e?e.findLastSelectedStrategy():this}selectItem(e){var t;this.updateSelectedItemByIndex(e),this.canFocusSelectedItem()?this.navigator.isActive&&!this.isNestedElementFocused()&&this.focusSelectedItem():null===(t=this.getSelectedItemStrategy())||void 0===t||t.activate()}isNestedElementFocused(){if(!document.activeElement||!this.nestedContentSelected)return!1;return X.findItemElementIndexByChild(this.items,document.activeElement)===this.selectedItemIndex}updateSelectedItemByIndex(e){const t=this.selectedItemElement;this.selectedItemIndex=this.validateItemIndex(e),t&&this.selectedItemElement!==t&&(X.scheduleResetTabIndex(t),this.nestedContentSelected=!1),this.canFocusSelectedItem()&&X.makeElementFocusable(this.selectedItemElement)}canFocusSelectedItem(){return this.targetElement===this.selectedItemElement||!this.getSelectedItemStrategy()}leaveFromNestedContent(){this.nestedContentSelected=!1,this.focusSelectedItem()}moveToPrevItem(){this.selectedItemIndex>0&&this.selectItem(this.selectedItemIndex-1)}moveToNextItem(){this.selectedItemIndex<this.itemCount-1&&this.selectItem(this.selectedItemIndex+1)}leaveBackward(){this.navigator.leaveFocus(!0)}leaveForward(){this.navigator.leaveFocus(!1)}handleKeyDown(e){const t=u.KeyUtils.getEventKeyCode(e);if(this.nestedContentSelected){if(t===u.KeyCode.Esc)return this.processEscapeKeyDown();if(t===u.KeyCode.Tab)return this.processTabKeyDown(e.shiftKey)}else if(t===u.KeyCode.Enter)return this.processEnter(e);return!1}handleKeyUp(e){return!1}processEscapeKeyDown(){return this.leaveFromNestedContent(),!0}processTabKeyDown(e){const t=X.findFocusableElements(this.selectedItemElement);if(t.length>0){const n=document.activeElement===t[0],s=document.activeElement===t[t.length-1];if(e&&n||!e&&s)return this.leaveFromNestedContent(),!0}return!1}processEnter(e){return!!this.processImmediatellyClick(e)||this.switchToNestedContent()}processImmediatellyClick(e){const t=X.findFocusableElements(this.selectedItemElement);if(0===t.length)return!0;if(1===t.length&&this.isImmediatelyClickEnabled()){const n=new MouseEvent("click",{bubbles:!0,cancelable:!0,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey});return t[0].dispatchEvent(n),!0}return!1}switchToNestedContent(){const e=X.findFocusableElements(this.selectedItemElement);return e.length>0&&(this.nestedContentSelected=!0,S(e[0]),!0)}performShortcutEvent(e){this.navigator.dispatchShortcutEvent(e)}isImmediatelyClickEnabled(){return!1}validateItemIndex(e){return e=Math.max(e,0),Math.min(e,this.items.length-1)}tryRestoreSelectedItem(e){if(e.isConnected){const t=this.items.indexOf(e);t>-1&&(this.selectedItemIndex=t)}}static makeElementFocusable(e){e.tabIndex<0&&E(e,"tabIndex","0")}static removeTabIndex(e){E(e,"tabIndex")}static scheduleResetTabIndex(e){setTimeout((()=>{X.removeTabIndex(e)}),0)}static findPrevFocusableElement(e){const t=X.findFocusableElements(document),n=t.findIndex((t=>t===e))-1;return n>=0?t[n]:null}static findNextFocusableNotChildElement(e){const t=X.findFocusableElements(document),n=X.findFocusableElements(e),s=t.findIndex((t=>t===e))+n.length+1;return s<t.length?t[s]:null}static findItemElementIndexByChild(e,t){return e.findIndex((e=>f.containsElement(e,t)))}static findFocusableElements(e){return Array.from(e.querySelectorAll(y)).filter((e=>e.tabIndex>-1&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)))}}class J extends CustomEvent{constructor(e,t){super(J.eventName,{detail:new Q(e,t),bubbles:!0,composed:!0,cancelable:!0})}}J.eventName="dxbl-keyboard-navigator.shortcut";class Q{constructor(e,t){this.Event=e,this.Info=JSON.stringify(t)}}I.register(J.eventName,(e=>{const t=e.detail;return{Key:t.Event.key,Code:t.Event.code,CtrlKey:t.Event.ctrlKey,AltKey:t.Event.altKey,ShiftKey:t.Event.shiftKey,MetaKey:t.Event.metaKey,Info:t.Info}}));const Z="dxbl-keyboard-navigator";var ee;!function(e){e[e.None=0]="None",e[e.Backward=1]="Backward",e[e.Forward=2]="Forward"}(ee||(ee={}));class te extends HTMLElement{constructor(){super(),this._isActive=!1,this._leaveDirection=ee.None,this.strategies=new Map,this.rootStrategy=null,this.contentChangedObserver=new MutationObserver(this.onContentChanged.bind(this))}get isActive(){return this._isActive}set isActive(e){this._isActive=e}get leaveDirection(){return this._leaveDirection}get targetElement(){var e;return null===(e=this.rootStrategy)||void 0===e?void 0:e.targetElement}initialize(e){this.rootStrategy=e,X.makeElementFocusable(this.rootStrategy.targetElement),this.contentChangedObserver.observe(this.targetElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["disabled"]}),se.register(this),this.attachStrategy(this.rootStrategy),this.rootStrategy.initialize()}disconnectedCallback(){this.disposeComponent()}disposeComponent(){this.contentChangedObserver.disconnect(),se.remove(this)}attachStrategy(e){e&&this.strategies.set(e.targetElement,e)}getStrategy(e){return e&&this.strategies.has(e)?this.strategies.get(e):null}onKeyDown(e){return this.handleKeyboardEvent(e,(t=>t.handleKeyDown(e)))}onKeyUp(e){return this.handleKeyboardEvent(e,(t=>t.handleKeyUp(e)))}dispatchShortcutEvent(e){const t=this.collectShortcutInfo(e);this.dispatchEvent(new J(e,t))}captureFocus(){var e;null===(e=this.findLastSelectedStrategy())||void 0===e||e.captureFocus()}leaveFocus(e){this._leaveDirection=e?ee.Backward:ee.Forward}getSelectedItemElement(){var e;return null===(e=this.findLastSelectedStrategy())||void 0===e?void 0:e.selectedItemElement}findLastSelectedStrategy(){var e;return null===(e=this.rootStrategy)||void 0===e?void 0:e.findLastSelectedStrategy()}onContentChanged(){this.detachDisconnectedStrategies(),this.rootStrategy&&(this.rootStrategy.initialize(),this.rootStrategy.activate())}handleKeyboardEvent(e,t){this._leaveDirection=ee.None;const n=ne(e,this.strategies);for(let e=0;e<n.length;e++){const s=n[e];if(t(s))return!0;if(s.nestedContentSelected)return!1}return!1}detachDisconnectedStrategies(){const e=Array.from(this.strategies.keys()).filter((e=>!e.isConnected));for(const t of e)this.strategies.delete(t)}collectShortcutInfo(e){const t=ne(e,this.strategies).map((e=>e.getShortcutContext()));return Object.assign({},...t)}}function ne(e,t){const n=[],s=e.composedPath();for(let e=0;e<s.length;e++){const i=s[e];if(t.has(i)){const e=t.get(i);e&&n.push(e)}}return n}const se=new class{constructor(){this.boundOnKeyDownHandler=this.handleKeyDown.bind(this),this.boundOnKeyUpHandler=this.handleKeyUp.bind(this),this.boundOnMouseDownHandler=this.handleMouseDown.bind(this),this.boundOnFocusInHandler=this.handleFocusIn.bind(this),this.navigators=new Map,this.lockStrategiesActivation=!1,document.addEventListener("keydown",this.boundOnKeyDownHandler,{capture:!0}),document.addEventListener("keyup",this.boundOnKeyUpHandler,{capture:!0}),document.addEventListener("mousedown",this.boundOnMouseDownHandler,{capture:!0}),document.addEventListener("focusin",this.boundOnFocusInHandler,{capture:!0})}register(e){const t=e.targetElement;this.navigators.has(t)||this.navigators.set(t,e)}remove(e){const t=e.targetElement;this.navigators.has(t)&&this.navigators.delete(t)}handleKeyDown(e){this.handleKeyboardEvent(e,(t=>t.onKeyDown(e)))}handleKeyUp(e){this.handleKeyboardEvent(e,(t=>t.onKeyUp(e)))}handleKeyboardEvent(e,t){const n=ne(e,this.navigators);for(let s=0;s<n.length;s++){const i=n[s];if(t(i)){if(i.leaveDirection!==ee.None){this.leaveFromNavigator(i,s<n.length-1?n[s+1]:null)}b.markHandled(e,!0);break}}}handleMouseDown(e){this.activateStrategiesTreeLine(e,!1)}handleFocusIn(e){this.updateActiveState(e),this.activateStrategiesTreeLine(e,!0)}activateStrategiesTreeLine(e,t){if(this.lockStrategiesActivation)return;const n=ne(e,this.navigators);0!==n.length&&(this.lockStrategiesActivation=!0,this.selectStrategiesTreeLine(e,n),this.activateFirstStrategyInTreeLine(e,n,t),this.lockStrategiesActivation=!1)}selectStrategiesTreeLine(e,t){const n=e.target;for(let s=0;s<t.length;s++){const i=ne(e,t[s].strategies);for(let e=0;e<i.length;e++){const t=0===e,s=i[e];s.updateSelectedItemByChildElement(n),s.nestedContentSelected=t}}}activateFirstStrategyInTreeLine(e,t,n){var s;const i=e.target,o=ne(e,t[0].strategies),r=o[0];if(n&&this.tryActivateByPrevFocusedElement(e,r))return;const l=r===r.navigator.rootStrategy;if(l&&r.activate(),!l||1===o.length){r.updateSelectedItemByChildElement(i);let t=r.selectedItemElement===i;if(!t){const n=e.composedPath().find((e=>e.tabIndex>-1));r.selectedItemElement!==n&&(null===(s=r.selectedItemElement)||void 0===s?void 0:s.contains(n))||(t=!0)}t&&(r.nestedContentSelected=!1,r.focusSelectedItem())}}tryActivateByPrevFocusedElement(e,t){const n=e.relatedTarget;if(!n)return!1;const s=t.navigator.rootStrategy;if(s.targetElement.contains(n))return!1;const i=e.target,o=X.findPrevFocusableElement(i),r=X.findNextFocusableNotChildElement(i);if(n!==o&&n!==r)return!1;t.nestedContentSelected=!1;return s.updateSelectedItemByIndex(n===r?s.itemCount-1:0),t.nestedContentSelected=!1,s.activate(),!0}updateActiveState(e){const t=ne(e,this.navigators),n=t.length>0?t[0]:null;this.navigators.forEach((e=>e.isActive=e===n))}leaveFromNavigator(e,t){const n=(e.leaveDirection===ee.Backward?X.findPrevFocusableElement:X.findNextFocusableNotChildElement)(e.targetElement),s=null==t?void 0:t.getSelectedItemElement();!n||s&&!s.contains(n)?t&&t.captureFocus():S(n)}};var ie,oe;customElements.define(Z,te),function(e){e[e.None=0]="None",e[e.GroupPanel=1]="GroupPanel",e[e.DataTable=2]="DataTable",e[e.Pager=3]="Pager"}(ie||(ie={}));class re extends X{constructor(e,t){super(e.getKeyboardNavigator(),t),this.grid=e}}!function(e){e[e.None=0]="None",e[e.Header=1]="Header",e[e.Filter=2]="Filter",e[e.Edit=3]="Edit",e[e.EditForm=4]="EditForm",e[e.Group=5]="Group",e[e.Data=6]="Data",e[e.EmptyData=7]="EmptyData",e[e.Detail=8]="Detail",e[e.Footer=9]="Footer",e[e.GroupFooter=10]="GroupFooter"}(oe||(oe={}));const le=`:scope > *:not(.${[N.IndentCellClassName,N.HeaderIndentCellClassName,N.GroupFooterIndentCellClassName,N.EmptyCellClassName,N.HiddenEmptyCellClassName].join(",.")})`;class ae extends re{constructor(e,t){super(e,t)}getShortcutContext(){return{RowType:this.getRowType(),VisibleIndex:this.getRowVisibleIndex()}}getRowVisibleIndex(){return this.targetElement.hasAttribute(D.VisibleIndexName)?parseInt(this.targetElement.getAttribute(D.VisibleIndexName)):-1}updateSelectedCellOffset(e){this.selectedItemIndex=Math.max(this.itemCount-e,0)}getSelectedCellOffset(){return this.itemCount-this.selectedItemIndex}leaveRow(){X.removeTabIndex(this.selectedItemElement)}queryItems(){return this.queryItemsBySelector(le)}handleKeyDown(e){if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Left:return this.moveToPrevItem(),!0;case u.KeyCode.Right:return this.moveToNextItem(),!0}return!1}selectItem(e){super.selectItem(e),this.navigator.isActive&&this.alignRequiredVisibleElement(this.selectedItemElement)}isImmediatelyClickEnabled(){return this.isActiveCommandCell()||this.isActiveExpandButtonCell()||this.isSelectionCell()}isActiveCommandCell(){var e,t;return null!==(t=null===(e=this.selectedItemElement)||void 0===e?void 0:e.classList.contains(N.CommandCellClassName))&&void 0!==t&&t}isActiveExpandButtonCell(){var e,t;return null!==(t=null===(e=this.selectedItemElement)||void 0===e?void 0:e.classList.contains(N.ExpandButtonCellClassName))&&void 0!==t&&t}isSelectionCell(){var e,t;return null!==(t=null===(e=this.selectedItemElement)||void 0===e?void 0:e.classList.contains(N.SelectionCellClassName))&&void 0!==t&&t}isFixedCell(e){var t;return null!==(t=null==e?void 0:e.classList.contains(N.FixedCellClassName))&&void 0!==t&&t}alignRequiredVisibleElement(e){const t=this.grid.getScrollViewerContent();if(t&&!this.isFixedCell(e)){e.scrollIntoView({block:"nearest"});const n=Array.from(Array(this.itemCount-this.selectedItemIndex-1),((e,t)=>++t)).map((e=>this.getItem(e+this.selectedItemIndex))).filter((e=>this.isFixedCell(e)));if(n.length>0){const s=ae.calculateScrollCorrection(e,n.reverse(),!1);t.scrollBy(s,0)}const s=Array.from(Array(this.selectedItemIndex),((e,t)=>t++)).map((e=>this.getItem(e))).filter((e=>this.isFixedCell(e)));if(s.length>0){const n=ae.calculateScrollCorrection(e,s,!0);t.scrollBy(n,0)}}}static calculateScrollCorrection(e,t,n){let s=0;const i=e.getBoundingClientRect();for(const e of t){const t=e.getBoundingClientRect(),o=g.getIntersectionRectangle(i,t);if(!o.isEmpty){const e=n?o.left-t.right:o.right-t.left;i.x-=e,s+=e}}return s}}class de extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.Header}getShortcutContext(){return{RowType:this.getRowType(),ColumnUID:this.getColumnUID()}}handleKeyDown(e){return this.nestedContentSelected||u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Space?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}isImmediatelyClickEnabled(){return!0}getColumnUID(){return this.grid.getColumnUID(this.selectedItemElement)}}class he extends ae{constructor(e,t){super(e,t)}handleKeyDown(e){if(this.nestedContentSelected&&this.isActiveEditorCell()){if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Tab)return e.shiftKey&&this.selectedItemIndex>0?(this.moveToPrevItem(),this.switchToNestedContent()):!e.shiftKey&&this.selectedItemIndex<this.itemCount-1?(this.moveToNextItem(),this.switchToNestedContent()):this.leaveFromNestedContent(),!0;if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Enter)return this.leaveFromNestedContent(),!0}return super.handleKeyDown(e)}isActiveEditorCell(){return!this.isActiveCommandCell()&&!this.isActiveExpandButtonCell()&&!this.isSelectionCell()}}class ce extends he{constructor(e,t){super(e,t)}getRowType(){return oe.Filter}}class ue extends he{constructor(e,t){super(e,t)}getRowType(){return oe.Edit}}class me extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.EditForm}}class ge extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.Group}queryItems(){return new Array}handleKeyDown(e){return this.nestedContentSelected||u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Left&&u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Right?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}}class Ce extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.Data}handleKeyDown(e){return this.nestedContentSelected||u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Space?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}}class pe extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.EmptyData}}class ve extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.Detail}}class be extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.Footer}}class fe extends ae{constructor(e,t){super(e,t)}getRowType(){return oe.GroupFooter}}const ye=`:scope > * > tr:not(.${N.EmptyRowClassName}):not([${x}]):not([${w}])`,Se=`.${N.HeaderRowClassName}`,Ee=`.${N.FilterRowClassName}`,Ie=`.${N.EditRowClassName}`,xe=`:scope > .${N.EditFormClassName}`,we=`.${N.GroupRowClassName}`,Re=`tr[${D.VisibleIndexName}]:not(.${N.EditRowClassName}):not(.${N.GroupRowClassName})`,Ne=`:scope > .${N.EmptyDataRowCellClassName}`,De=`:scope > .${N.DetailCellClassName}`,Pe=`.${N.FooterRowClassName}`,He=`.${N.GroupFooterRowClassName}`;class We extends re{constructor(e,t){super(e,t),this.savedCellOffset=-1,this.savedVisibleIndex=-1}getShortcutContext(){return{AreaType:ie.DataTable}}queryItems(){return this.queryItemsBySelector(ye)}getSelectedItemStrategy(){return super.getSelectedItemStrategy()}createItemStrategy(e){switch(We.getRowType(e)){case oe.Header:return new de(this.grid,e);case oe.Filter:return new ce(this.grid,e);case oe.Edit:return new ue(this.grid,e);case oe.EditForm:return new me(this.grid,e);case oe.Group:return new ge(this.grid,e);case oe.Data:return new Ce(this.grid,e);case oe.EmptyData:return new pe(this.grid,e);case oe.Detail:return new ve(this.grid,e);case oe.Footer:return new be(this.grid,e);case oe.GroupFooter:return new fe(this.grid,e)}throw new Error("Not implemented")}selectItem(e){const t=this.getSelectedItemStrategy(),n=this.getStrategy(e);this.saveFocusedRowVisibleIndex(n);const s=this.calcNewCellOffset(t,n);s>-1&&n.updateSelectedCellOffset(s),super.selectItem(e),t&&t!==n&&t.leaveRow()}getStrategy(e){return e=this.validateItemIndex(e),this.navigator.getStrategy(this.getItem(e))}saveFocusedRowVisibleIndex(e){this.isFocusableRow(e.getRowType())&&(this.savedVisibleIndex=e.getRowVisibleIndex())}calcNewCellOffset(e,t){return e&&e!==t&&(this.shouldUpdateSavedCellIndex(e.getRowType())&&(this.savedCellOffset=e.getSelectedCellOffset()),this.shouldApplySavedCellIndex(t.getRowType()))?this.savedCellOffset:-1}shouldUpdateSavedCellIndex(e){switch(e){case oe.Header:case oe.Filter:case oe.Edit:case oe.Data:case oe.Footer:case oe.GroupFooter:return!0}return!1}shouldApplySavedCellIndex(e){switch(e){case oe.Header:case oe.Filter:case oe.Edit:case oe.Data:case oe.Footer:case oe.GroupFooter:return!0}return!1}isFocusableRow(e){switch(e){case oe.Group:case oe.Edit:case oe.Data:return!0}return!1}handleKeyDown(e){switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Down:return this.moveToNextItem(),!0;case u.KeyCode.Up:return this.moveToPrevItem(),!0;case u.KeyCode.Tab:if(e.shiftKey)return this.moveToHeaderRow()}return!1}handleKeyUp(e){switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Down:case u.KeyCode.Up:this.grid.enableFocusedRow&&this.savedVisibleIndex>-1&&(this.grid.notifyFocusedRowChanged(this.savedVisibleIndex),this.savedVisibleIndex=-1)}return!1}moveToHeaderRow(){const e=this.findHeaderRowItemIndex();return e>-1&&e!==this.selectedItemIndex&&(this.selectItem(e),!0)}findHeaderRowItemIndex(){for(let e=0;e<this.itemCount;e++)if(We.getRowType(this.getItem(e))===oe.Header)return e;return-1}static getRowType(e){return e.matches(Se)?oe.Header:e.matches(Ee)?oe.Filter:e.matches(Ie)?oe.Edit:e.querySelector(xe)?oe.EditForm:e.matches(we)?oe.Group:e.matches(Re)?oe.Data:e.querySelector(Ne)?oe.EmptyData:e.querySelector(De)?oe.Detail:e.matches(Pe)?oe.Footer:e.matches(He)?oe.GroupFooter:oe.None}}class Te extends re{constructor(e){super(e,e),this.searchBoxInputSelector=`.${N.SearchBoxClassName} > input`}queryItems(){return new Array(this.getPagerPanel(!0),Fe.findTargetElement(this.grid),this.getDataTable(),this.getPagerPanel(!1))}createItemStrategy(e){return e===Fe.findTargetElement(this.grid)?new Fe(this.grid,e):e===this.getDataTable()?new We(this.grid,e):e===this.getPagerPanel(!0)||e===this.getPagerPanel(!1)?new Ae(this.grid,e):null}handleKeyDown(e){return!!super.handleKeyDown(e)||(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Tab?(e.shiftKey?this.moveToPrevItem():this.moveToNextItem(),!0):!(!e.ctrlKey||u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Key_f)&&this.tryFocusSearchBox())}moveToPrevItem(){this.selectedItemIndex>0?super.moveToPrevItem():this.leaveBackward()}moveToNextItem(){this.selectedItemIndex<this.itemCount-1?super.moveToNextItem():this.leaveForward()}getDataTable(){return this.grid.getDataTable()}getPagerPanel(e){return this.grid.getPagerPanel(e)}tryFocusSearchBox(){const e=this.grid.getSearchBoxContainer();if(e){const t=e.querySelector(this.searchBoxInputSelector);return(null!=t?t:e).focus(),!0}return!1}}class Fe extends re{constructor(e,t){super(e,t),this.itemSelector=`.${N.HeaderElementClassName}`}getShortcutContext(){return{AreaType:ie.GroupPanel,ColumnUID:this.getColumnUID()}}queryItems(){const e=this.queryItemsBySelector(this.itemSelector);return e.push(this.grid.getSearchBoxContainer()),e}handleKeyDown(e){if(e.ctrlKey&&(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Enter||u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Space))return!0;if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Left:return this.moveToPrevItem(),!0;case u.KeyCode.Right:return this.moveToNextItem(),!0;case u.KeyCode.Space:return this.performShortcutEvent(e),!0}return!1}isImmediatelyClickEnabled(){return this.selectedItemElement!==this.grid.getSearchBoxContainer()}getColumnUID(){return this.grid.getColumnUID(this.selectedItemElement)}static findTargetElement(e){const t=e.getGroupPanelContentContainer();if(t)return t.parentElement;const n=e.getSearchBoxContainer();return n?n.parentElement:null}}class Ae extends re{constructor(e,t){super(e,t)}getShortcutContext(){return{AreaType:ie.Pager}}}const Me="http://www.w3.org/2000/svg";class _e{constructor(){this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0,this._borderColor="",this._borderWidth="",this._color="",this._textAlign="",this._lineHeight=""}assign(e){this._paddingLeft=parseFloat(e.paddingLeft),this._paddingTop=parseFloat(e.paddingTop),this._paddingRight=parseFloat(e.paddingRight),this._paddingBottom=parseFloat(e.paddingBottom),this._color=e.color,this._borderColor=e.borderColor,this._borderWidth=e.borderTopWidth,this._lineHeight=e.lineHeight}merge(e){this._paddingLeft=parseFloat(e.paddingLeft),this._paddingTop=parseFloat(e.paddingTop),this._paddingRight=parseFloat(e.paddingRight),this._paddingBottom=parseFloat(e.paddingBottom),this._textAlign=e.textAlign}copyFrom(e){this._paddingLeft=e._paddingLeft,this._paddingTop=e._paddingTop,this._paddingRight=e._paddingRight,this._paddingBottom=e._paddingBottom,this._color=e._color,this._borderColor=e._borderColor,this._borderWidth=e._borderWidth,this._lineHeight=e._lineHeight,this._textAlign=e._textAlign}get elementHeight(){return this.getElementHeight()}get textAlignment(){return this._textAlign}get color(){return this._color}get borderColor(){return this._borderColor}get borderWidth(){return this._borderWidth}get paddingRight(){return this._paddingRight}get paddingLeft(){return this._paddingLeft}get paddingTop(){return this._paddingTop}get paddingBottom(){return this._paddingBottom}getElementHeight(){const e=parseFloat(this._lineHeight);return parseFloat(this._borderWidth)+this._paddingTop+e+this._paddingBottom}}class Be{constructor(e){this._svgPlaceHolderItems=30,this._topSpacer=null,this._bottomSpacer=null,this._mainElement=null,this._lastLeftFixedColumnUid=null,this._updateTimerId=-1,this._attemptsCount=0,this.defaultElementStyle=null,this.patternElementSelector=`.${N.DataTableClassName} > tbody > tr[${R}]:not([${x}]):not([${w}]):not(.${N.EmptyRowClassName}):not(.${N.GroupRowClassName})`,this.owner=e}initialize(){this._mainElement=this.owner.getMainElement(),this._topSpacer=this._mainElement.querySelector(`tr[${x}]`),this._bottomSpacer=this._mainElement.querySelector(`tr[${w}]`)}dispose(){this.defaultElementStyle=null}updatePlaceholders(){this._mainElement&&(this._attemptsCount=0,this.updatePlaceholdersCore())}updatePlaceholdersCore(){-1!==this._updateTimerId&&clearTimeout(this._updateTimerId);!this.updateSpacerPlaceholders()&&this._attemptsCount++<=500&&(this._updateTimerId=setTimeout((()=>this.updatePlaceholdersCore()),50))}updateSpacerPlaceholders(){if(!this._topSpacer||!this._bottomSpacer)return!1;this.createDefaultStyleSettings();const e=this.owner.columnsInfo,t=this.getPatternElement();if(!t)return!1;for(let n=0;n<e.length;n++){const s=e[n];if(!s.isIndent&&!s.isEmpty){const e=this.getElementStyle(t,n);this.setElementContent(this._topSpacer.children[n],e),this.setElementContent(this._bottomSpacer.children[n],e),this.ensureSetElementFixedStyle(s,n)}}return!0}ensureSetElementFixedStyle(e,t){this._topSpacer&&this._bottomSpacer&&(e.fixedPosition?("left"===e.fixedPosition&&this._lastLeftFixedColumnUid!==e.uID&&(this._lastLeftFixedColumnUid=e.uID),this._topSpacer.children[t].setAttribute("class",N.FixedCellClassName),this._bottomSpacer.children[t].setAttribute("class",N.FixedCellClassName)):null!==this._lastLeftFixedColumnUid&&(this._topSpacer.children[t-1].classList.add(N.LastLeftFixedCellClassName),this._bottomSpacer.children[t-1].classList.add(N.LastLeftFixedCellClassName),this._lastLeftFixedColumnUid=null))}createDefaultStyleSettings(){if(this._mainElement){const e=document.createElement("div");e.setAttribute("class","dxbl-virtual-spacer-pattern-cell"),this._mainElement.appendChild(e),this.defaultElementStyle=new _e,this.defaultElementStyle.assign(getComputedStyle(e)),this._mainElement.removeChild(e)}}getElementStyle(e,t){const n=new _e;if(this.defaultElementStyle&&n.copyFrom(this.defaultElementStyle),e){const s=getComputedStyle(e.children[t]);n.merge(s)}return n}getPatternElement(){if(this._mainElement){const e=this._mainElement.querySelector(this.patternElementSelector);if(e){if(!!e.querySelector(`:scope > td.${N.EmptyDataRowCellClassName}`))return null}return e}return null}setElementContent(e,t){if(t){const n=e.getBoundingClientRect().width,s=e.children[0],i=this.createBorders(t);this.setContent(s,i);const o=e.children[1],r=this.createContentPlaceholder(n,t);this.setContent(o,r)}}setContent(e,t){e.style.setProperty("background-image","url("+t+")")}createSVGImage(e,t,n){const s=e,i=t,o=document.createElementNS(Me,"svg");o.setAttribute("width",s.toString()),o.setAttribute("height",i.toString()),o.setAttribute("shape-rendering",n);const r=document.createElementNS(Me,"rect");return r.setAttribute("width",s.toString()),r.setAttribute("height",i.toString()),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("style","fill-opacity:0;"),o.appendChild(r),o}serializeSvgImage(e){const t=new XMLSerializer;return'"data:image/svg+xml;utf8,'+encodeURIComponent(t.serializeToString(e))+'"'}createBorders(e){const t=e.elementHeight,n=this.createSVGImage(1,t*this._svgPlaceHolderItems,"crispEdges");let s=0;for(let i=0;i<this._svgPlaceHolderItems;i++){const o=document.createElementNS(Me,"line");o.setAttribute("x1","0"),o.setAttribute("y1",i>0?s.toString():(s+1).toString());const r=e.borderColor,l=e.borderWidth;o.setAttribute("x2",1..toString()),o.setAttribute("y2",s.toString()),o.setAttribute("style",`stroke:${r}; stroke-width:${l};`),n.appendChild(o),s+=t}return this.serializeSvgImage(n)}createContentPlaceholder(e,t){const n=t.elementHeight,s=e,i=this.createSVGImage(s,n*this._svgPlaceHolderItems,"geometricPrecision");let o=0;for(let e=0;e<this._svgPlaceHolderItems;e++){const e=document.createElementNS(Me,"rect"),r=o+t.paddingTop,l=s*this.getRandomArbitrary(.3,.8),a=n-t.paddingTop-t.paddingBottom;e.setAttribute("width",l.toString()),e.setAttribute("height",a.toString());let d=0;switch(t.textAlignment){case"center":d=(s-l)/2;break;case"right":d=s-(t.paddingRight+l);break;default:d=t.paddingLeft}e.setAttribute("x",d.toString()),e.setAttribute("y",r.toString()),e.setAttribute("rx",(n/3).toString()),e.setAttribute("style",`fill:${t.color};`),i.appendChild(e),o+=n}return this.serializeSvgImage(i)}getRandomArbitrary(e,t){return Math.random()*(t-e)+e}}const Oe=document.createElement("template");Oe.innerHTML="\n<style></style>\n<slot />";const Le="dxbl-grid",ze="data-dx-grid-uid";class Ke extends e{constructor(){super(),this._columnsInfo=[],this._allowSelectRowByClick=!1,this._enableFocusedRow=!1,this._enableMultiSelect=!1,this._hasRowClickEvent=!1,this._hasRowDblClickEvent=!1,this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.boundOnScrollViewerUpdateHandler=this.onScrollViewerUpdate.bind(this),this.boundOnScrollViewerScrollHandler=this.onScrollViewerScroll.bind(this),this.boundOnDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.boundOnMouseDownHandler=this.onMouseDown.bind(this),this.currentWidth=-1,this.draggingHelper=new V(this),this.columnWidthsController=new j(this),this.selectionHelper=new q(this),this._styleGenerator=null,this.resizeObserver=new ResizeObserver(this.onSizeChanged.bind(this)),this._virtualSpacerAppearanceProvider=new Be(this)}initializeComponent(){super.initializeComponent(),this._styleGenerator=new Y(this),this.uiHandlersBridge=this.querySelector(d),this.initializeKeyboardNavigator(),this.ensureColumnResizeStrategy(),this.addEventSubscriptions(),this.resizeObserver.observe(this),this.virtualSpacerAppearanceProvider.initialize()}disposeComponent(){this.removeEventSubscriptions(),this.resizeObserver.unobserve(this),this.virtualSpacerAppearanceProvider.dispose(),delete this.uiHandlersBridge,delete this.keyboardNavigator,super.disposeComponent()}get hoverTitleElementsSelector(){return P.TitleElementsSelector}getMainElement(){return this}getDataTable(){return this.querySelector(`.${N.DataTableClassName}`)}getHeaderRow(){return this.querySelector(`thead > tr.${N.HeaderRowClassName}`)}getFilterRow(){return this.querySelector(`thead > tr.${N.FilterRowClassName}`)}getHeaderCells(){return this.querySelectorAll(`.${N.HeaderElementClassName}`)}getGroupPanelContentContainer(){return this.querySelector(`.${N.GroupPanelContentContainerClassName}`)}getSearchBoxContainer(){return this.querySelector(`.${N.SearchBoxContainerClassName}`)}getEmptyHeaderCellContentContainer(){return this.querySelector(`.${N.EmptyHeaderCellContentContainerClassName}`)}getGroupContentFreeSpaceElement(){return this.querySelector(`.${N.GroupContentFreeSpaceClassName}`)}getColElements(){return this.querySelectorAll(P.ColElementSelector)}getFooterRow(){return this.querySelector(`.${N.FooterRowClassName}`)}getPagerPanel(e){return this.querySelector(`:scope > .${N.PagerPanelClassName}.${e?N.TopPanelClassName:N.BottomPanelClassName}`)}getScrollViewer(){return this.querySelector(`.${n.ClassName}`)}getScrollViewerContent(){return this.querySelector(`.${n.ContentContainerClassName}`)}getTableContainerWidth(){const e=this.getScrollViewerContent();return e?null==e?void 0:e.getBoundingClientRect().width:0}getColumnResizeSeparator(){return this.querySelector(`.${N.ColumnsSeparatorClassName}`)}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(Z),this.keyboardNavigator&&!this.keyboardNavigator.rootStrategy&&this.keyboardNavigator.initialize(new Te(this))}getKeyboardNavigator(){return this.keyboardNavigator}getColElementOffsetWidth(e){let t=this.getColElements()[e].getBoundingClientRect().width;if(0===t&&(h.Browser.Safari||h.Browser.MacOSMobilePlatform)){const n=this.getHeaderRow();t=n?n.cells[e].getBoundingClientRect().width:null}return t}addEventSubscriptions(){var e;this.addEventListener(o.eventName,this.boundOnDragStartHandler),this.addEventListener(r.eventName,this.boundOnDragStopHandler),this.addEventListener(l.eventName,this.boundOnDragCancelHandler),this.addEventListener(a.eventName,this.boundOnClickHandler),this.addEventListener(C.eventName,this.boundOnScrollViewerUpdateHandler),null===(e=this.getScrollViewer())||void 0===e||e.subscribeToScroll(this.boundOnScrollViewerScrollHandler),document.addEventListener("keydown",this.boundOnDocumentKeyDownHandler),h.Browser.Firefox&&this.addEventListener("mousedown",this.boundOnMouseDownHandler)}removeEventSubscriptions(){var e;this.removeEventListener(o.eventName,this.boundOnDragStartHandler),this.removeEventListener(r.eventName,this.boundOnDragStopHandler),this.removeEventListener(l.eventName,this.boundOnDragCancelHandler),this.removeEventListener(a.eventName,this.boundOnClickHandler),this.removeEventListener(C.eventName,this.boundOnScrollViewerUpdateHandler),null===(e=this.getScrollViewer())||void 0===e||e.unsubscribeFromScroll(),document.removeEventListener("keydown",this.boundOnDocumentKeyDownHandler),h.Browser.Firefox&&this.removeEventListener("mousedown",this.boundOnMouseDownHandler)}onDragStart(e){var t,n,s;const i=e.target,o=e.detail.source;if(this.isResizeAnchor(i)){const e=this.findHeaderElement(i),n=this.getElementIndex(e);null===(t=this.columnResizeStrategy)||void 0===t||t.startDrag(n,o.pageX)}else if(this.isHeaderContentElement(i)){const e=this.findHeaderElement(i);e&&(this.draggingHelper.start(e,o),null===(n=this.getScrollViewer())||void 0===n||n.startAutoScrolling(m.Horizontal,(e=>this.draggingHelper.updateDraggableContextByEvent(e))))}else this.selectionHelper.start(o.target,!o.ctrlKey&&!o.metaKey&&!e.detail.isLongTap),null===(s=this.getScrollViewer())||void 0===s||s.startAutoScrolling(m.Vertical,(e=>this.selectionHelper.updateSeletionByEvent(e)),(e=>{const t=this.getDataTable();if(t){const n=t.querySelector("thead");n&&(e.y+=n.offsetHeight,e.height-=n.offsetHeight);const s=t.querySelector("tfoot");s&&(e.height-=s.offsetHeight)}}));e.stopPropagation()}onDragStop(e){var t,n;if(null===(t=this.columnResizeStrategy)||void 0===t?void 0:t.isResizing)this.columnResizeStrategy.stopDrag();else if(this.draggingHelper.isStarted()){const e=this.draggingHelper.createColumnDraggedHandlerArgs();this.draggingHelper.stop(),this.onColumnDragged(e)}else if(this.selectionHelper.isStarted()){if(this.uiHandlersBridge&&this.selectionHelper.startSelectionRowIndex>-1&&this.selectionHelper.endSelectionRowIndex>-1){this.uiHandlersBridge.send("rowDragged",{startVisibleIndex:this.selectionHelper.startSelectionRowIndex,endVisibleIndex:this.selectionHelper.endSelectionRowIndex,cleanSelection:!e.detail.source.ctrlKey&&!e.detail.source.metaKey&&!e.detail.isLongTap})}this.selectionHelper.stop()}null===(n=this.getScrollViewer())||void 0===n||n.stopAutoScrolling(),e.stopPropagation()}onDragCancel(e){var t,n;(null===(t=this.columnResizeStrategy)||void 0===t?void 0:t.isResizing)?this.columnResizeStrategy.cancelDrag():this.draggingHelper.isStarted()?this.draggingHelper.stop():this.selectionHelper.isStarted()&&this.selectionHelper.stop(),null===(n=this.getScrollViewer())||void 0===n||n.stopAutoScrolling(),e.stopPropagation()}onClick(e){this.isResizeAnchor(e.target)&&e.detail.source.stopPropagation()}onScrollViewerUpdate(e){const t=this.getScrollViewerContent(),n=this.getDataTable();t&&n&&(n.offsetHeight<t.clientHeight?c.DomUtils.addClassName(n,N.DataTableNoScrollClassName):n.offsetHeight>t.clientHeight&&c.DomUtils.removeClassName(n,N.DataTableNoScrollClassName)),e.stopPropagation()}onScrollViewerScroll(){this.styleGenerator.scrollPositionUpdated(this.getScrollViewerContent())}getRowVisibleIndexByTarget(e,t){let n=e;for(;n&&n!==this&&(t||!n.classList.contains(N.EditRowClassName));){if("tr"===n.tagName.toLowerCase()&&n.dataset.visibleIndex)return parseInt(n.dataset.visibleIndex);n=n.parentElement}return-1}get allowSelectRowByClick(){return this._allowSelectRowByClick}set allowSelectRowByClick(e){this._allowSelectRowByClick=e,this.updateHandlePointerEventsMode()}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e,this.updateHandlePointerEventsMode()}get enableFocusedRow(){return this._enableFocusedRow}set enableFocusedRow(e){this._enableFocusedRow=e,this.updateHandlePointerEventsMode()}get keyboardNavigationEnabled(){return!!this.keyboardNavigator}get hasRowClickEvent(){return this._hasRowClickEvent}set hasRowClickEvent(e){this._hasRowClickEvent=e,this.updateHandlePointerEventsMode()}get hasRowDblClickEvent(){return this._hasRowDblClickEvent}set hasRowDblClickEvent(e){this._hasRowDblClickEvent=e,this.updateHandlePointerEventsMode()}get columnsInfo(){return this._columnsInfo}get styleGenerator(){return this._styleGenerator}get virtualSpacerAppearanceProvider(){return this._virtualSpacerAppearanceProvider}updateHandlePointerEventsMode(){this.handlePointerEventsMode=s.None,(this.hasRowClickEvent||this.enableFocusedRow)&&(this.handlePointerEventsMode|=s.Click),this.hasRowDblClickEvent&&(this.handlePointerEventsMode|=s.DblClick),this.allowSelectRowByClick&&(this.handlePointerEventsMode|=s.Click,this.enableMultiSelect&&h.Browser.TouchUI&&(this.handlePointerEventsMode|=s.Dragging))}notifyFocusedRowChanged(e){if(this.enableFocusedRow&&this.uiHandlersBridge){this.uiHandlersBridge.send("focusedRowChanged",{visibleIndex:e})}}notifyColumnsInitialized(e){this._columnsInfo=e}notifyColumnsChanged(e){this._columnsInfo=e,this.correctWidths(k.ColumnsChanged)}notifyColumnResizeAnchorFocus(e){var t;const n=this.findHeaderElement(e),s=this.getElementIndex(n);null===(t=this.columnResizeStrategy)||void 0===t||t.anchorFocused(s)}notifyColumnResizeAnchorBlur(){var e;null===(e=this.columnResizeStrategy)||void 0===e||e.anchorUnfocused()}notifyColumnResizeAnchorMove(e){var t;null===(t=this.columnResizeStrategy)||void 0===t||t.performMoveStep(e)}updateEmptyColumnVisibility(){this.columnWidthsController.updateEmptyColumnVisibility()}correctWidths(e){var t;if(null===(t=this.columnResizeStrategy)||void 0===t?void 0:t.isResizing)return;this.columnWidthsController.correctWidths(e);const n=this.getScrollViewer();n&&n.refreshUI&&n.refreshUI()}getElementIndex(e){if(!e)return-1;if(e instanceof HTMLTableCellElement)return e.cellIndex;if(e&&e.parentElement)for(let t=0;t<e.parentElement.children.length;t++)if(e.parentElement.children[t]===e)return t;return-1}getColumnInfo(e){const t=this.findHeaderElement(e),n=this.getElementIndex(t);return 0<=n&&n<this.columnsInfo.length?this.columnsInfo[n]:null}getColumnUID(e){const t=this.getColumnInfo(e);return t?t.uID:-1}findHeaderElement(e){const t=e;return t?this.isHeaderElement(t)?t:t.closest(`.${N.HeaderElementClassName}`):null}isHeaderElement(e){return e&&e.classList.contains(N.HeaderElementClassName)}isHeaderContentElement(e){return e.tagName.toLowerCase()===H}isResizeAnchor(e){return e.classList.contains(N.ColumnsResizeAnchorClassName)}onDocumentKeyDown(e){if(!this.keyboardNavigationEnabled&&("Enter"===e.key||" "===e.key)){const t=this.findHeaderElement(e.target);if(t){const n=new MouseEvent("click",{bubbles:!0,cancelable:!0,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey});t.dispatchEvent(n)}}}onMouseDown(e){e.ctrlKey&&e.preventDefault()}onColumnChooserItemDragged(e,t){this.onColumnDragged({columnUid:e,beforeColumnUid:t,dropArea:$.ColumnChooser})}onColumnDragged(e){e&&this.uiHandlersBridge&&this.uiHandlersBridge.send("columnHeaderDragged",e)}onColumnWidthsChanged(e,t){this.uiHandlersBridge&&this.uiHandlersBridge.send("columnWidthsChanged",{columnUids:e,widths:t})}onSizeChanged(e){const t=e[0].contentRect.width;this.currentWidth!==t&&t>0&&(this.correctWidths(-1===this.currentWidth?k.ColumnsChanged:k.GridResize),this.currentWidth=t)}getContentTemplate(){return Oe}static get observedAttributes(){return["allow-select-row-by-click","enable-multi-select","has-row-click-event","has-row-dbl-click-event","resize-mode","enable-focused-row"]}attributeChangedCallback(e,t,n){var s;switch(e){case"allow-select-row-by-click":this.allowSelectRowByClick=null!==n;break;case"enable-focused-row":this.enableFocusedRow=null!==n;break;case"enable-multi-select":this.enableMultiSelect=null!==n;break;case"has-row-click-event":this.hasRowClickEvent=null!==n;break;case"has-row-dbl-click-event":this.hasRowDblClickEvent=null!==n;break;case"resize-mode":null===(s=this.columnResizeStrategy)||void 0===s||s.cancelDrag(),this.ensureColumnResizeStrategy()}}ensureColumnResizeStrategy(){const e=this.getAttribute("resize-mode");this.columnResizeStrategy=e?"next-column"===e?new M(this):new _(this):void 0}static findGrid(e){return document.querySelector(`${Le}[${ze}="${e}"]`)}}customElements.define(Le,Ke),customElements.define(H,class extends e{constructor(){super(),this.handlePointerEventsMode=s.Click|s.Dragging}get handlePointerEventsTarget(){return this.closest(`.${N.HeaderElementClassName}`)}get handlePointerEventsDelay(){return i}}),customElements.define("dxbl-grid-columns-info",class extends e{get data(){return this.getAttribute("data")}get columns(){return null!==this.data?this.parseColumns(this.data):[]}constructor(){super()}initializeComponent(){super.initializeComponent(),this.grid=this.closest(`.${N.ClassName}`),this.grid.notifyColumnsInitialized(this.columns)}parseColumns(e){const t=JSON.parse(e),n=[];for(let e=0;e<t.length;e++){const s=t[e],i=new W(s.UID,s.AllowGroup,s.Width,s.MinWidth,s.FixedPosition,s.IsIndent,s.IsEmpty,s.IsDetail);n.push(i)}return n}static get observedAttributes(){return["data"]}attributeChangedCallback(e,t,n){var s;null===(s=this.grid)||void 0===s||s.notifyColumnsChanged(this.parseColumns(n))}}),customElements.define("dxbl-column-resize-anchor",class extends e{constructor(){super(),this.boundOnAnchorFocusHandler=this.onAnchorFocus.bind(this),this.boundOnAnchorBlurHandler=this.onAnchorBlur.bind(this),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.handlePointerEventsMode=s.Click|s.Dragging}get handlePointerEventsDelay(){return i}initializeComponent(){var e,n,s;super.initializeComponent(),h.Browser.TouchUI&&this.classList.add(t.Touch),this.grid=this.closest(`.${N.ClassName}`),this.focusableElement=this.querySelector("div"),null===(e=this.focusableElement)||void 0===e||e.addEventListener("focus",this.boundOnAnchorFocusHandler),null===(n=this.focusableElement)||void 0===n||n.addEventListener("blur",this.boundOnAnchorBlurHandler),null===(s=this.focusableElement)||void 0===s||s.addEventListener("keydown",this.boundOnKeyDownHandler)}disposeComponent(){var e,t,n;super.disposeComponent(),null===(e=this.focusableElement)||void 0===e||e.removeEventListener("focus",this.boundOnAnchorFocusHandler),null===(t=this.focusableElement)||void 0===t||t.removeEventListener("blur",this.boundOnAnchorBlurHandler),null===(n=this.focusableElement)||void 0===n||n.removeEventListener("keydown",this.boundOnKeyDownHandler)}onAnchorFocus(e){var t;null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorFocus(e.target)}onAnchorBlur(){var e;null===(e=this.grid)||void 0===e||e.notifyColumnResizeAnchorBlur()}onKeyDown(e){var t,n;e.keyCode===u.KeyCode.Left&&(e.preventDefault(),null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorMove(F.Left)),e.keyCode===u.KeyCode.Right&&(e.preventDefault(),null===(n=this.grid)||void 0===n||n.notifyColumnResizeAnchorMove(F.Right))}}),customElements.define("dxbl-column-resize-separator",B),customElements.define("dxbl-grid-column-chooser",class extends e{constructor(){super(),this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.grid=null,this.scrollViewer=null,this.itemsReorderHelper=new L(this.onItemsReording.bind(this)),this.handlePointerEventsMode=s.Dragging}get handlePointerEventsDelay(){return i}get useShadowDom(){return!1}initializeComponent(){super.initializeComponent(),this.addEventSubscriptions(),this.grid=Ke.findGrid(this.getAttribute(ze)),this.scrollViewer=this.querySelector(`.${n.ClassName}`)}disposeComponent(){super.disposeComponent(),this.removeEventSubscriptions()}addEventSubscriptions(){this.addEventListener(o.eventName,this.boundOnDragStartHandler),this.addEventListener(r.eventName,this.boundOnDragStopHandler),this.addEventListener(l.eventName,this.boundOnDragCancelHandler)}removeEventSubscriptions(){this.removeEventListener(o.eventName,this.boundOnDragStartHandler),this.removeEventListener(r.eventName,this.boundOnDragStopHandler),this.removeEventListener(l.eventName,this.boundOnDragCancelHandler)}onDragStart(e){var t;const n=e.detail.source,s=n.target,i=s.closest(`.${N.ColumnChooserItemDragAnchorClassName}`),o=s.closest(`.${N.ColumnChooserItemClassName}`);if(null!=i&&null!=o){const e=Array.from(this.getElementsByClassName(N.ColumnChooserItemClassName));this.itemsReorderHelper.start(e,o,n),null===(t=this.scrollViewer)||void 0===t||t.startAutoScrolling(m.Vertical,(()=>{this.itemsReorderHelper.refreshUI()}))}}onDragStop(e){var t;this.itemsReorderHelper.stop(),null===(t=this.scrollViewer)||void 0===t||t.stopAutoScrolling()}onDragCancel(e){var t;this.itemsReorderHelper.cancel(),null===(t=this.scrollViewer)||void 0===t||t.stopAutoScrolling()}onItemsReording(e,t,n,s){const i=t.indexOf(n),o=e[n];let r=null;if(!(i===t.length-1)){r=e[t[i+1]]}this.applyStyles(e,o,r,s),s===O.Stop&&this.onItemsReorded(o,r)}applyStyles(e,t,n,s){for(let t=0;t<e.length;t++){const i=e[t],o=i.classList.contains(N.ColumnChooserDraggingItemNextSiblingClassName);(s!==O.ItemMoving||o&&i!==n)&&i.classList.remove(N.ColumnChooserDraggingItemNextSiblingClassName)}s===O.ItemMoving?(t.classList.contains(N.ColumnChooserDraggingItemClassName)||t.classList.add(N.ColumnChooserDraggingItemClassName),null==n||n.classList.contains(N.ColumnChooserDraggingItemNextSiblingClassName)||n.classList.add(N.ColumnChooserDraggingItemNextSiblingClassName)):(t.classList.remove(N.ColumnChooserDraggingItemClassName),null==n||n.classList.remove(N.ColumnChooserDraggingItemNextSiblingClassName))}onItemsReorded(e,t){if(null==this.grid)return;const n=parseInt(e.getAttribute(z)),s=null!=t?parseInt(t.getAttribute(z)):null;setTimeout((()=>{var e;return null===(e=this.grid)||void 0===e?void 0:e.onColumnChooserItemDragged(n,s)}),200)}});const $e={loadModule:function(){}};export{Ke as DxGrid,Le as DxGridTagName,ze as DxGridUidAttributeName,$e as default};
